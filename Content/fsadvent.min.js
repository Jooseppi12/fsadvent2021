(function(n){"use strict";Date.now||(Date.now=function(){return(new Date).getTime()});Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Object.setPrototypeOf||(Object.setPrototypeOf=function(n,t){return n.__proto__=t,n});n.IntelliFactory={Runtime:{Ctor:function(n,t){return n.prototype=t.prototype,n},Class:function(n,t,i){var u=n,f,r,e;if(t){u=new t;for(f in n)u[f]=n[f]}if(r=function(n){if(n)for(var t in n)this[t]=n[t]},r.prototype=u,i)for(e in i)r[e]=i[e];return r},Clone:function(n){var t={};for(var i of Object.getOwnPropertyNames(n))t[i]=n[i];return Object.setPrototypeOf(t,Object.getPrototypeOf(n)),t},NewObject:function(n){for(var i={},t=0;t<n.length;t++)i[n[t][0]]=n[t][1];return i},PrintObject:function(n){var t="{ ",i=!0;for(var r of Object.getOwnPropertyNames(n))i?i=!1:t+=", ",t+=r+" = "+n[r];return t+(i?"}":" }")},DeleteEmptyFields:function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],n[r]===void 0&&delete n[r];return n},GetOptional:function(n){return n===void 0?null:{$:1,$0:n}},SetOptional:function(n,t,i){i?n[t]=i.$0:delete n[t]},SetOrDelete:function(n,t,i){i===void 0?delete n[t]:n[t]=i},Apply:function(n,t,i){return n.apply(t,i)},Bind:function(n){return function(){return n.apply(this,arguments)}},CreateFuncWithArgs:function(n){return function(){return n(Array.prototype.slice.call(arguments))}},CreateFuncWithOnlyThis:function(n){return function(){return n(this)}},CreateFuncWithThis:function(n){return function(){return n(this).apply(null,arguments)}},CreateFuncWithThisArgs:function(n){return function(){return n(this)(Array.prototype.slice.call(arguments))}},CreateFuncWithRest:function(n,t){return function(){return t(Array.prototype.slice.call(arguments,0,n).concat([Array.prototype.slice.call(arguments,n)]))}},CreateFuncWithArgsRest:function(n,t){return function(){return t([Array.prototype.slice.call(arguments,0,n),Array.prototype.slice.call(arguments,n)])}},BindDelegate:function(n,t){var i=n.bind(t);return i.$Func=n,i.$Target=t,i},CreateDelegate:function(n){if(n.length==0)return null;if(n.length==1)return n[0];var t=function(){for(var i,t=0;t<n.length;t++)i=n[t].apply(null,arguments);return i};return t.$Invokes=n,t},CombineDelegates:function(n){for(var t,i=[],r=0;r<n.length;r++)t=n[r],t&&("$Invokes"in t?i=i.concat(t.$Invokes):i.push(t));return IntelliFactory.Runtime.CreateDelegate(i)},DelegateEqual:function(n,t){var f,e,i,r,u;if(n===t)return!0;if(n==null||t==null||(f=n.$Invokes||[n],e=t.$Invokes||[t],f.length!=e.length))return!1;for(i=0;i<f.length;i++)if(r=f[i],u=e[i],!(r===u||"$Func"in r&&"$Func"in u&&r.$Func===u.$Func&&r.$Target==u.$Target))return!1;return!0},ThisFunc:function(n){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),n.apply(null,t)}},ThisFuncOut:function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(t.shift(),t)}},ParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat([i.slice(n)]))}},ParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat(i[n]))}},ThisParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(null,i.slice(0,n+1).concat([i.slice(n+1)]))}},ThisParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(i.shift(),i.slice(0,n).concat(i[n]))}},Curried:function(n,t,i){return i=i||[],function(r){var u=i.concat([r===void 0?null:r]);return t==1?n.apply(null,u):t==2?function(t){return n.apply(null,u.concat([t===void 0?null:t]))}:IntelliFactory.Runtime.Curried(n,t-1,u)}},Curried2:function(n){return function(t){return function(i){return n(t,i)}}},Curried3:function(n){return function(t){return function(i){return function(r){return n(t,i,r)}}}},UnionByType:function(n,t,i){for(var u,f=typeof t,r=0;r<n.length;r++)if(u=n[r],typeof u=="number"){if(Array.isArray(t)&&(u==0||t.length==u))return{$:r,$0:t}}else if(u==f)return{$:r,$0:t};if(!i)throw new Error("Type not expected for creating Choice value.");},ScriptBasePath:"./",ScriptPath:function(n,t){return this.ScriptBasePath+(this.ScriptSkipAssemblyDir?"":n+"/")+t},OnLoad:function(n){"load"in this||(this.load=[]);this.load.push(n)},Start:function(){function n(n){for(var t=0;t<n.length;t++)n[t]()}"load"in this&&(n(this.load),this.load=[])}}};n.IntelliFactory.Runtime.OnLoad(function(){n.WebSharper&&WebSharper.Activator&&WebSharper.Activator.Activate&&WebSharper.Activator.Activate()});n.ignore=function(){};n.id=function(n){return n};n.fst=function(n){return n[0]};n.snd=function(n){return n[1]};n.trd=function(n){return n[2]};n.console||(n.console={count:ignore,dir:ignore,error:ignore,group:ignore,groupEnd:ignore,info:ignore,log:ignore,profile:ignore,profileEnd:ignore,time:ignore,timeEnd:ignore,trace:ignore,warn:ignore})})(self);
/* https://github.com/jonathantneal/closest */
(function(w,p){p=w.Element.prototype
if(!p.matches){p.matches=p.msMatchesSelector||function(s){var m=(this.document||this.ownerDocument).querySelectorAll(s);for(var i=0;m[i]&&m[i]!==e;++i);return!!m[i]}}
if(!p.closest){p.closest=function(s){var e=this;while(e&&e.nodeType==1){if(e.matches(s))return e;e=e.parentNode}return null}}})(self);
(function(){for(var i=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})})();
(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf;b=a.fsadvent=a.fsadvent||{};c=b.Client=b.Client||{};d=a.WebSharper=a.WebSharper||{};e=d.Operators=d.Operators||{};f=d.Obj=d.Obj||{};g=d.UI=d.UI||{};h=g.Var=g.Var||{};i=a.StartupCode$fsadvent$Client=a.StartupCode$fsadvent$Client||{};j=d.JavaScript=d.JavaScript||{};k=j.Pervasives=j.Pervasives||{};l=g.Doc=g.Doc||{};m=g.Templating=g.Templating||{};n=m.Runtime=m.Runtime||{};o=n.Server=n.Server||{};p=o.TemplateInstance=o.TemplateInstance||{};q=d.Arrays=d.Arrays||{};r=o.ProviderBuilder=o.ProviderBuilder||{};s=d.List=d.List||{};t=o.Handler=o.Handler||{};u=g.View=g.View||{};v=d.Seq=d.Seq||{};w=d.Unchecked=d.Unchecked||{};x=a.fsadvent_Templates=a.fsadvent_Templates||{};y=a.fsadvent_Router=a.fsadvent_Router||{};z=c.EndPoint=c.EndPoint||{};A=g.Client=g.Client||{};B=A.Templates=A.Templates||{};C=g.Router=g.Router||{};D=g.Var$1=g.Var$1||{};E=d.Forms=d.Forms||{};F=E.Form=E.Form||{};G=j.JS=j.JS||{};H=d.Strings=d.Strings||{};I=d.Utils=d.Utils||{};J=g.HtmlModule=g.HtmlModule||{};K=J.attr=J.attr||{};L=g.Submitter=g.Submitter||{};M=a.System=a.System||{};N=M.Guid=M.Guid||{};O=d.Collections=d.Collections||{};P=O.List=O.List||{};Q=s.T=s.T||{};R=O.FSharpSet=O.FSharpSet||{};S=g.AttrModule=g.AttrModule||{};T=g.Snap=g.Snap||{};U=a.EventTarget;V=a.Node;W=O.Dictionary=O.Dictionary||{};X=d.Sitelets=d.Sitelets||{};Y=X.RouterOperators=X.RouterOperators||{};Z=X.RouterModule=X.RouterModule||{};_0=g.ConcreteVar=g.ConcreteVar||{};_1=O.BalancedTree=O.BalancedTree||{};_2=E.Fresh=E.Fresh||{};_3=g.Array=g.Array||{};_4=g.AttrProxy=g.AttrProxy||{};_5=g.Docs=g.Docs||{};_6=a.Object;_7=g.CheckedInput=g.CheckedInput||{};_8=d.Numeric=d.Numeric||{};_9=g.Attrs=g.Attrs||{};_=g.DomUtility=g.DomUtility||{};$=d.Enumerator=d.Enumerator||{};ba=O.HashSet=O.HashSet||{};bb=o.TemplateInitializer=o.TemplateInitializer||{};bc=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bd=a.WindowOrWorkerGlobalScope;be=X.Router=X.Router||{};bf=X.Route=X.Route||{};bg=X.List=X.List||{};bh=d.Option=d.Option||{};bi=g.Abbrev=g.Abbrev||{};bj=bi.Fresh=bi.Fresh||{};bk=E.Result=E.Result||{};bl=g.DocElemNode=g.DocElemNode||{};bm=a.CharacterData;bn=_1.Tree=_1.Tree||{};bo=g.DynamicAttrNode=g.DynamicAttrNode||{};bp=O.DictionaryUtil=O.DictionaryUtil||{};bq=$.T=$.T||{};br=B.Prepare=B.Prepare||{};bs=d.Slice=d.Slice||{};bt=O.KeyCollection=O.KeyCollection||{};bu=g.An=g.An||{};bv=A.Settings=A.Settings||{};bw=bi.Mailbox=bi.Mailbox||{};bx=O.FSharpMap=O.FSharpMap||{};by=O.Map=O.Map||{};bz=d.Concurrency=d.Concurrency||{};bA=E.ErrorMessage=E.ErrorMessage||{};bB=a.StartupCode$WebSharper_Forms$Forms=a.StartupCode$WebSharper_Forms$Forms||{};bC=A.Attrs=A.Attrs||{};bD=bC.Dyn=bC.Dyn||{};bE=g.Elt=g.Elt||{};bF=A.Docs=A.Docs||{};bG=bF.RunState=bF.RunState||{};bH=bF.NodeSet=bF.NodeSet||{};bI=g.Anims=g.Anims||{};bJ=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bK=O.Pair=O.Pair||{};bL=d.Lazy=d.Lazy||{};bM=X.PathUtil=X.PathUtil||{};bN=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};bO=g.Updates=g.Updates||{};bP=O.ValueCollection=O.ValueCollection||{};bQ=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};bR=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};bS=g.AppendList=g.AppendList||{};bT=O.HashSetUtil=O.HashSetUtil||{};bU=d.LazyExtensionsProxy=d.LazyExtensionsProxy||{};bV=bU.LazyRecord=bU.LazyRecord||{};bW=O.MapUtil=O.MapUtil||{};bX=bz.Scheduler=bz.Scheduler||{};bY=d.Queue=d.Queue||{};bZ=g.BindVar=g.BindVar||{};b0=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};b1=g.Easing=g.Easing||{};b2=bz.AsyncBody=bz.AsyncBody||{};b3=a.StartupCode$WebSharper_Main$Concurrency=a.StartupCode$WebSharper_Main$Concurrency||{};b4=bz.CT=bz.CT||{};b5=bi.HashSet=bi.HashSet||{};b6=g.String=g.String||{};b7=d.CancellationTokenSource=d.CancellationTokenSource||{};b8=bF.DomNodes=bF.DomNodes||{};b9=d.Char=d.Char||{};b_=a.Error;b$=d.OperationCanceledException=d.OperationCanceledException||{};ca=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};cb=a.IntelliFactory;cc=cb&&cb.Runtime;cd=a.console;ce=a.Math;cf=a.Date;c.Main=function(){var cg;cg=l.BindView(function(ch){return ch.$==1?c.CheckoutView():c.HomeView();},c.routerInstance().get_View());B.LoadLocalTemplates("");l.RunById("main",cg);};c.routerInstance=function(){i.$cctor();return i.routerInstance;};c.CheckoutView=function(){return c.checkoutForm();};c.HomeView=function(){var cg,ch,ci,cj,ck,cl,cm;return(cg=(ch=(ci=(cj=s.map(function(cn){var co,cp,cq,cr,cs,ct,cu,cv;return(co=(cp=(cq=u.Const("disabled"),S.DynamicPred("disabled",u.Map(function(cw){return v.contains(cn,cw);},c.itemsToOrder().get_View()),cq)),(cr=(cs=(ct=new r.New$1(),(ct.h.push({$:1,$0:"name",$1:cn}),ct)),(cs.h.push(t.EventQ2(cs.k,"addtocart",function(){return cs.i;},function(){c.itemsToOrder().Update(function(cw){return cw.Add(cn);});})),cs)),(cr.h.push({$:3,$0:"canbeadded",$1:cp}),cr))),(cu=t.CompleteHoles(co.k,co.h,[]),(cv=new p.New(cu[1],x.item(cu[0])),co.i=cv,cv))).get_Doc();},c.items()),(ck=new r.New$1(),(ck.h.push({$:0,$0:"itemstoshopfor",$1:l.Concat(cj)}),ck))),(ci.h.push({$:0,$0:"itemstocheckout",$1:c.renderedcart()}),ci)),(ch.h.push(t.EventQ2(ch.k,"gotocheckout",function(){return ch.i;},function(){c.routerInstance().Set(z.Checkout);})),ch)),(cl=t.CompleteHoles(cg.k,cg.h,[]),(cm=new p.New(cl[1],x.home(cl[0])),cg.i=cm,cm))).get_Doc();};c.checkoutForm=function(){i.$cctor();return i.checkoutForm;};c.renderedcart=function(){i.$cctor();return i.renderedcart;};c.items=function(){i.$cctor();return i.items;};c.itemsToOrder=function(){i.$cctor();return i.itemsToOrder;};c.router=function(){i.$cctor();return i.router;};c.cartForm=function(){i.$cctor();return i.cartForm;};e.FailWith=function(cg){throw new b_(cg);};e.KeyValue=function(cg){return[cg.K,cg.V];};f=d.Obj=cc.Class({Equals:function(cg){return this===cg;},GetHashCode:function(){return -1;}},null,f);f.New=cc.Ctor(function(){},f);h=g.Var=cc.Class({},f,h);h.New=cc.Ctor(function(){f.New.call(this);},h);i.$cctor=function(){i.$cctor=a.ignore;function cg(ch,ci){var cj;cj=l.BindView(function(ck){return l.Concat(s.map(function(cl){return l.Element("div",[],[l.Element("span",[],[l.TextNode(cl)]),l.Element("button",[S.Handler("click",function(){return function(){return ch.Update(function(cm){return cm.Remove(cl);});};})],[l.TextNode("Remove")])]);},s.ofSeq(ck)));},ch.get_View());return l.Element("div",[],[l.Element("h1",[],[l.TextNode("Checkout Page")]),cj,l.Element("div",[_4.Create("class","checkout-control")],[l.Element("button",[S.Handler("click",function(){return function(){return ci.Trigger();};})],[l.TextNode("Order")]),l.Element("button",[S.Handler("click",function(){return function(){return c.routerInstance().Set(z.Home);};})],[l.TextNode("Go back")])])]);}i.router=y.r();i.routerInstance=C.Install(z.Home,c.router());i.itemsToOrder=D.Create$1(new R.New$1(null));i.items=s.ofArray(["apple","orange","banana","grape","pear"]);i.cartForm=F.WithSubmit(F.YieldVar(c.itemsToOrder()));i.checkoutForm=F.Render(function(ch){return function(ci){return cg(ch,ci);};},F.Run(function(ch){a.alert((function(ci){return function(cj){return ci("You have ordered: "+I.toSafe(cj));};}(a.id))(H.concat(",",ch)));},c.cartForm()));i.renderedcart=c.cartForm().render(function(ch){return function(){return l.BindView(function(ci){return l.Concat(s.map(function(cj){return l.Element("div",[_4.Create("class","item")],[l.TextNode(cj)]);},s.ofSeq(ci)));},ch.get_View());};});};k.NewFromSeq=function(cg){var ch,ci,cj;ch={};ci=$.Get(cg);try{while(ci.MoveNext()){cj=ci.Current();ch[cj[0]]=cj[1];}}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}return ch;};l=g.Doc=cc.Class({},f,l);l.BindView=function(cg,ch){return l.EmbedView(u.Map(cg,ch));};l.RunById=function(cg,ch){var ci;ci=self.document.getElementById(cg);if(w.Equals(ci,null))e.FailWith("invalid id: "+cg);else l.Run(ci,ch);};l.Concat=function(cg){var ch;ch=_3.ofSeqNonCopying(cg);return _3.TreeReduce(l.get_Empty(),l.Append,ch);};l.EmbedView=function(cg){var ch;ch=_5.CreateEmbedNode();return l.Mk({$:2,$0:ch},u.Map(a.ignore,u.Bind(function(ci){_5.UpdateEmbedNode(ch,ci.docNode);return ci.updates;},cg)));};l.Run=function(cg,ch){_5.LinkElement(cg,ch.docNode);l.RunInPlace(false,cg,ch);};l.Append=function(cg,ch){return l.Mk({$:0,$0:cg.docNode,$1:ch.docNode},u.Map2Unit(cg.updates,ch.updates));};l.get_Empty=function(){return l.Mk(null,u.Const());};l.TextNode=function(cg){return l.Mk({$:5,$0:self.document.createTextNode(cg)},u.Const());};l.Mk=function(cg,ch){return new l.New(cg,ch);};l.RunInPlace=function(cg,ch,ci){var cj;cj=_5.CreateRunState(ch,ci.docNode);u.Sink(bu.get_UseAnimations()||bv.BatchUpdatesEnabled()?bw.StartProcessor(_5.PerformAnimatedUpdate(cg,cj,ci.docNode)):function(){_5.PerformSyncUpdate(cg,cj,ci.docNode);},ci.updates);};l.Element=function(cg,ch,ci){var cj,ck;cj=_4.Concat(ch);ck=l.Concat(ci);return bE.New(self.document.createElement(cg),cj,ck);};l.TextView=function(cg){var ch;ch=_5.CreateTextNode();return l.Mk({$:4,$0:ch},u.Map(function(ci){_5.UpdateTextNode(ch,ci);},cg));};l.New=cc.Ctor(function(cg,ch){f.New.call(this);this.docNode=cg;this.updates=ch;},l);p=o.TemplateInstance=cc.Class({get_Doc:function(){return this.doc;}},f,p);p.New=cc.Ctor(function(cg,ch){f.New.call(this);this.doc=ch;this.allVars=cg.$==0?cg.$0:e.FailWith("Should not happen");},p);q.get=function(cg,ch){q.checkBounds(cg,ch);return cg[ch];};q.length=function(cg){return cg.dims===2?cg.length*cg.length:cg.length;};q.checkBounds=function(cg,ch){if(ch<0||ch>=cg.length)e.FailWith("Index was outside the bounds of the array.");};q.set=function(cg,ch,ci){q.checkBounds(cg,ch);cg[ch]=ci;};r=o.ProviderBuilder=cc.Class({},f,r);r.New$1=cc.Ctor(function(){var cg;f.New.call(this);this.i=null;this.k=(cg=N.NewGuid(),a.String(cg));this.h=[];cc.SetOptional(this,"s",null);},r);s.map=function(cg,ch){var ci,cj,ck,cl,cm;if(ch.$==0)return ch;else{cl=new Q({$:1});ci=cl;cj=ch;ck=true;while(ck){ci.$0=cg(cj.$0);cj=cj.$1;if(cj.$==0)ck=false;else ci=(cm=new Q({$:1}),ci.$1=cm,cm);}ci.$1=Q.Empty;return cl;}};s.ofArray=function(cg){var ch,ci,cj;ch=Q.Empty;for(ci=q.length(cg)-1,cj=0;ci>=cj;ci--)ch=new Q({$:1,$0:q.get(cg,ci),$1:ch});return ch;};s.rev=function(cg){var ch,ci;ch=Q.Empty;ci=cg;while(ci.$==1){ch=new Q({$:1,$0:ci.$0,$1:ch});ci=ci.$1;}return ch;};s.ofSeq=function(cg){var ch,ci,cj,ck,cl,cm;if(cg instanceof Q)return cg;else if(cg instanceof a.Array)return s.ofArray(cg);else{ch=$.Get(cg);try{cj=ch.MoveNext();if(!cj)ci=Q.Empty;else{cl=new Q({$:1});ck=cl;while(cj){ck.$0=ch.Current();if(ch.MoveNext())ck=(cm=new Q({$:1}),ck.$1=cm,cm);else cj=false;}ck.$1=Q.Empty;ci=cl;}return ci;}finally{if(typeof ch=="object"&&"Dispose"in ch)ch.Dispose();}}};s.head=function(cg){return cg.$==1?cg.$0:s.listEmpty();};s.tail=function(cg){return cg.$==1?cg.$1:s.listEmpty();};s.listEmpty=function(){return e.FailWith("The input list was empty.");};s.iter=function(cg,ch){var ci;ci=ch;while(ci.$==1){cg(s.head(ci));ci=s.tail(ci);}};t.EventQ2=function(cg,ch,ci,cj){return{$:5,$0:ch,$1:function(ck){return function(cl){return cj({Vars:ci(),Target:ck,Event:cl});};}};};t.CompleteHoles=function(cg,ch,ci){var ck,cl,cm,cn,co;function cj(cp,cq){var cr;return cl.Contains(cp)?null:(cr=w.Equals(cq,0)?bb.GetOrAddHoleFor(cg,cp,function(){return{$:8,$0:cp,$1:D.Create$1("")};}):w.Equals(cq,1)?bb.GetOrAddHoleFor(cg,cp,function(){return{$:13,$0:cp,$1:D.Create$1(0)};}):w.Equals(cq,2)?bb.GetOrAddHoleFor(cg,cp,function(){return{$:9,$0:cp,$1:D.Create$1(false)};}):e.FailWith("Invalid value type"),(ck.set_Item(cp,cr),{$:1,$0:cr}));}ck=new W.New$5();cl=new ba.New$3();cm=$.Get(ch);try{while(cm.MoveNext()){cn=cm.Current();co=cn.$0;cl.Add(co);ck.set_Item(co,cn);}}finally{if(typeof cm=="object"&&"Dispose"in cm)cm.Dispose();}return[v.append(ch,q.choose(function(cp){return cj(cp[0],cp[1]);},ci)),{$:0,$0:ck}];};u=g.View=cc.Class({},null,u);v.append=function(cg,ch){return{GetEnumerator:function(){var ci,cj;ci=$.Get(cg);cj=[true];return new bq.New(ci,null,function(ck){var cl;return ck.s.MoveNext()?(ck.c=ck.s.Current(),true):(cl=ck.s,!w.Equals(cl,null)?cl.Dispose():void 0,ck.s=null,cj[0]&&(cj[0]=false,ck.s=$.Get(ch),ck.s.MoveNext()?(ck.c=ck.s.Current(),true):(ck.s.Dispose(),ck.s=null,false)));},function(ck){var cl;cl=ck.s;if(!w.Equals(cl,null))cl.Dispose();});}};};v.head=function(cg){var ch;ch=$.Get(cg);try{return ch.MoveNext()?ch.Current():v.insufficient();}finally{if(typeof ch=="object"&&"Dispose"in ch)ch.Dispose();}};v.iteri=function(cg,ch){var ci,cj;ci=0;cj=$.Get(ch);try{while(cj.MoveNext()){cg(ci,cj.Current());ci=ci+1;}}finally{if(typeof cj=="object"&&"Dispose"in cj)cj.Dispose();}};v.collect=function(cg,ch){return v.concat(v.map(cg,ch));};v.indexed=function(cg){return v.mapi(function(ch,ci){return[ch,ci];},cg);};v.map=function(cg,ch){return{GetEnumerator:function(){var ci;ci=$.Get(ch);return new bq.New(null,null,function(cj){return ci.MoveNext()&&(cj.c=cg(ci.Current()),true);},function(){ci.Dispose();});}};};v.tryFindIndex=function(cg,ch){var ci,cj,ck;ci=$.Get(ch);try{cj=true;ck=0;while(cj&&ci.MoveNext())if(cg(ci.Current()))cj=false;else ck=ck+1;return cj?null:{$:1,$0:ck};}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}};v.tryPick=function(cg,ch){var ci,cj;ci=$.Get(ch);try{cj=null;while(w.Equals(cj,null)&&ci.MoveNext())cj=cg(ci.Current());return cj;}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}};v.concat=function(cg){return{GetEnumerator:function(){var ch;function ci(cj){var ck;while(true){ck=cj.s;if(w.Equals(ck,null)){if(ch.MoveNext()){cj.s=$.Get(ch.Current());cj=cj;}else{ch.Dispose();return false;}}else if(ck.MoveNext()){cj.c=ck.Current();return true;}else{cj.Dispose();cj.s=null;cj=cj;}}}ch=$.Get(cg);return new bq.New(null,null,ci,function(cj){var ck;ck=cj.s;if(!w.Equals(ck,null))ck.Dispose();if(!w.Equals(ch,null))ch.Dispose();});}};};v.mapi=function(cg,ch){return v.map2(cg,v.initInfinite(a.id),ch);};v.fold=function(cg,ch,ci){var cj,ck;cj=ch;ck=$.Get(ci);try{while(ck.MoveNext())cj=cg(cj,ck.Current());return cj;}finally{if(typeof ck=="object"&&"Dispose"in ck)ck.Dispose();}};v.forall2=function(cg,ch,ci){return!v.exists2(function(cj,ck){return!cg(cj,ck);},ch,ci);};v.map2=function(cg,ch,ci){return{GetEnumerator:function(){var cj,ck;cj=$.Get(ch);ck=$.Get(ci);return new bq.New(null,null,function(cl){return cj.MoveNext()&&ck.MoveNext()&&(cl.c=cg(cj.Current(),ck.Current()),true);},function(){cj.Dispose();ck.Dispose();});}};};v.initInfinite=function(cg){return{GetEnumerator:function(){return new bq.New(0,null,function(ch){ch.c=cg(ch.s);ch.s=ch.s+1;return true;},void 0);}};};v.exists2=function(cg,ch,ci){var cj,ck,cl,cm;cj=$.Get(ch);try{cl=$.Get(ci);try{cm=false;while(!cm&&cj.MoveNext()&&cl.MoveNext())cm=cg(cj.Current(),cl.Current());ck=cm;}finally{if(typeof cl=="object"&&"Dispose"in cl)cl.Dispose();}return ck;}finally{if(typeof cj=="object"&&"Dispose"in cj)cj.Dispose();}};v.unfold=function(cg,ch){return{GetEnumerator:function(){return new bq.New(ch,null,function(ci){var cj;cj=cg(ci.s);return cj==null?false:(ci.c=cj.$0[0],ci.s=cj.$0[1],true);},void 0);}};};v.iter=function(cg,ch){var ci;ci=$.Get(ch);try{while(ci.MoveNext())cg(ci.Current());}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}};v.rev=function(cg){return v.delay(function(){return q.ofSeq(cg).slice().reverse();});};v.distinctBy=function(cg,ch){return{GetEnumerator:function(){var ci,cj;ci=$.Get(ch);cj=new ba.New$3();return new bq.New(null,null,function(ck){var cl,cm;if(ci.MoveNext()){cl=ci.Current();cm=cj.Add(cg(cl));while(!cm&&ci.MoveNext()){cl=ci.Current();cm=cj.Add(cg(cl));}return cm&&(ck.c=cl,true);}else return false;},function(){ci.Dispose();});}};};v.max=function(cg){var ch,ci,cj;ch=$.Get(cg);try{if(!ch.MoveNext())v.seqEmpty();ci=ch.Current();while(ch.MoveNext()){cj=ch.Current();if(w.Compare(cj,ci)===1)ci=cj;}return ci;}finally{if(typeof ch=="object"&&"Dispose"in ch)ch.Dispose();}};v.delay=function(cg){return{GetEnumerator:function(){return $.Get(cg());}};};v.distinct=function(cg){return v.distinctBy(a.id,cg);};v.seqEmpty=function(){return e.FailWith("The input sequence was empty.");};v.compareWith=function(cg,ch,ci){var cj,ck,cl,cm,cn;cj=$.Get(ch);try{cl=$.Get(ci);try{cm=0;cn=true;while(cn&&cm===0)if(cj.MoveNext())cm=cl.MoveNext()?cg(cj.Current(),cl.Current()):1;else if(cl.MoveNext())cm=-1;else cn=false;ck=cm;}finally{if(typeof cl=="object"&&"Dispose"in cl)cl.Dispose();}return ck;}finally{if(typeof cj=="object"&&"Dispose"in cj)cj.Dispose();}};v.forall=function(cg,ch){return!v.exists(function(ci){return!cg(ci);},ch);};v.exists=function(cg,ch){var ci,cj;ci=$.Get(ch);try{cj=false;while(!cj&&ci.MoveNext())cj=cg(ci.Current());return cj;}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}};u.Const=function(cg){var ch;ch=T.New({$:0,$0:cg});return function(){return ch;};};u.Map=function(cg,ch){return u.CreateLazy(function(){return T.Map(cg,ch());});};u.Bind=function(cg,ch){return u.Join(u.Map(cg,ch));};u.CreateLazy=function(cg){var ch;ch={c:null,o:cg};return function(){var ci,cj;ci=ch.c;return ci===null?(ci=ch.o(),ch.c=ci,(cj=ci.s,cj!=null&&cj.$==0)?ch.o=null:T.WhenObsoleteRun(ci,function(){ch.c=null;}),ci):ci;};};u.Map2=function(cg,ch,ci){return u.CreateLazy(function(){return T.Map2(cg,ch(),ci());});};u.Sink=function(cg,ch){function ci(){T.WhenRun(ch(),cg,function(){bz.scheduler().Fork(ci);});}bz.scheduler().Fork(ci);};u.Map2Unit=function(cg,ch){return u.CreateLazy(function(){return T.Map2Unit(cg(),ch());});};u.Join=function(cg){return u.CreateLazy(function(){return T.Join(cg());});};u.SnapshotOn=function(cg,ch,ci){var cj;cj=T.New({$:2,$0:cg,$1:[]});return u.CreateLazy(function(){return cj.s==null?T.SnapshotOn(ch(),ci()):(T.WhenObsolete(ch(),cj),cj);});};u.Map3=function(cg,ch,ci,cj){return u.CreateLazy(function(){return T.Map3(cg,ch(),ci(),cj());});};u.Sequence=function(cg){return u.CreateLazy(function(){return T.Sequence(v.map(function(ch){return ch();},cg));});};w.Equals=function(cg,ch){var ci,cj,ck,cl;if(cg===ch)return true;else{ci=typeof cg;if(ci=="object"){if(cg===null||cg===void 0||ch===null||ch===void 0||!w.Equals(typeof ch,"object"))return false;else if("Equals"in cg)return cg.Equals(ch);else if("Equals"in ch)return false;else if(cg instanceof a.Array&&ch instanceof a.Array)return w.arrayEquals(cg,ch);else if(cg instanceof a.Date&&ch instanceof a.Date)return w.dateEquals(cg,ch);else{cj=[true];for(var cm in cg)if(function(cn){cj[0]=!cg.hasOwnProperty(cn)||ch.hasOwnProperty(cn)&&w.Equals(cg[cn],ch[cn]);return!cj[0];}(cm))break;if(cj[0]){for(var cn in ch)if(function(co){cj[0]=!ch.hasOwnProperty(co)||cg.hasOwnProperty(co);return!cj[0];}(cn))break;}return cj[0];}}else return ci=="function"&&("$Func"in cg?cg.$Func===ch.$Func&&cg.$Target===ch.$Target:"$Invokes"in cg&&"$Invokes"in ch&&w.arrayEquals(cg.$Invokes,ch.$Invokes));}};w.arrayEquals=function(cg,ch){var ci,cj;if(q.length(cg)===q.length(ch)){ci=true;cj=0;while(ci&&cj<q.length(cg)){!w.Equals(q.get(cg,cj),q.get(ch,cj))?ci=false:void 0;cj=cj+1;}return ci;}else return false;};w.dateEquals=function(cg,ch){return cg.getTime()===ch.getTime();};w.Hash=function(cg){var ch;ch=typeof cg;return ch=="function"?0:ch=="boolean"?cg?1:0:ch=="number"?cg:ch=="string"?w.hashString(cg):ch=="object"?cg==null?0:cg instanceof a.Array?w.hashArray(cg):w.hashObject(cg):0;};w.hashString=function(cg){var ch,ci,cj;if(cg===null)return 0;else{ch=5381;for(ci=0,cj=cg.length-1;ci<=cj;ci++)ch=w.hashMix(ch,cg[ci].charCodeAt());return ch;}};w.hashArray=function(cg){var ch,ci,cj;ch=-34948909;for(ci=0,cj=q.length(cg)-1;ci<=cj;ci++)ch=w.hashMix(ch,w.Hash(q.get(cg,ci)));return ch;};w.hashObject=function(cg){var ch,ci;if("GetHashCode"in cg)return cg.GetHashCode();else{ch=[0];for(var cj in cg)if(function(ck){ch[0]=w.hashMix(w.hashMix(ch[0],w.hashString(ck)),w.Hash(cg[ck]));return false;}(cj))break;return ch[0];}};w.Compare=function(cg,ch){var ci,cj,ck,cl,cm,cn;if(cg===ch)return 0;else{cj=typeof cg;switch(cj=="function"?1:cj=="boolean"?2:cj=="number"?2:cj=="string"?2:cj=="object"?3:0){case 0:return typeof ch=="undefined"?0:-1;case 1:return e.FailWith("Cannot compare function values.");case 2:return cg<ch?-1:1;case 3:if(cg===null)ck=-1;else if(ch===null)ck=1;else if("CompareTo"in cg)ck=cg.CompareTo(ch);else if("CompareTo0"in cg)ck=cg.CompareTo0(ch);else if(cg instanceof a.Array&&ch instanceof a.Array)ck=w.compareArrays(cg,ch);else if(cg instanceof a.Date&&ch instanceof a.Date)ck=w.compareDates(cg,ch);else{cl=[0];for(var co in cg)if(function(cp){return!cg.hasOwnProperty(cp)?false:!ch.hasOwnProperty(cp)?(cl[0]=1,true):(cl[0]=w.Compare(cg[cp],ch[cp]),cl[0]!==0);}(co))break;if(cl[0]===0){for(var cp in ch)if(function(cq){return!ch.hasOwnProperty(cq)?false:!cg.hasOwnProperty(cq)&&(cl[0]=-1,true);}(cp))break;}ck=cl[0];}return ck;}}};w.hashMix=function(cg,ch){return(cg<<5)+cg+ch;};w.compareArrays=function(cg,ch){var ci,cj;if(q.length(cg)<q.length(ch))return -1;else if(q.length(cg)>q.length(ch))return 1;else{ci=0;cj=0;while(ci===0&&cj<q.length(cg)){ci=w.Compare(q.get(cg,cj),q.get(ch,cj));cj=cj+1;}return ci;}};w.compareDates=function(cg,ch){return w.Compare(cg.getTime(),ch.getTime());};x.item=function(cg){B.LoadLocalTemplates("index");return cg?B.NamedTemplate("index",{$:1,$0:"item"},cg):void 0;};x.home=function(cg){B.LoadLocalTemplates("index");return cg?B.NamedTemplate("index",{$:1,$0:"home"},cg):void 0;};y.r=function(){return Y.JSUnion(void 0,[[null,[[null,[]]],[]],[null,[[null,["checkout"]]],[]]]);};z.Checkout={$:1};z.Home={$:0};B.LoadLocalTemplates=function(cg){!B.LocalTemplatesLoaded()?(B.set_LocalTemplatesLoaded(true),B.LoadNestedTemplates(self.document.body,"")):void 0;B.LoadedTemplates().set_Item(cg,B.LoadedTemplateFile(""));};B.LocalTemplatesLoaded=function(){bc.$cctor();return bc.LocalTemplatesLoaded;};B.set_LocalTemplatesLoaded=function(cg){bc.$cctor();bc.LocalTemplatesLoaded=cg;};B.LoadNestedTemplates=function(cg,ch){var cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv;function ci(cw){var cx,cy;if(!cj.ContainsKey(cw)){cx=(cy=null,[ck.TryGetValue(cw,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy]);if(cx[0]){cv.Add(cw);ck.Remove(cw);B.PrepareTemplateStrict(ch,{$:1,$0:cw},cx[1],{$:1,$0:ci});}else cd.warn(cv.Contains(cw)?"Encountered loop when instantiating "+cw:"Local template does not exist: "+cw);}}cj=B.LoadedTemplateFile(ch);ck=new W.New$5();cl=cg.querySelectorAll("[ws-template]");for(cm=0,cn=cl.length-1;cm<=cn;cm++){co=cl[cm];cp=co.getAttribute("ws-template").toLowerCase();co.removeAttribute("ws-template");ck.set_Item(cp,B.FakeRootSingle(co));}cq=cg.querySelectorAll("[ws-children-template]");for(cr=0,cs=cq.length-1;cr<=cs;cr++){ct=cq[cr];cu=ct.getAttribute("ws-children-template").toLowerCase();ct.removeAttribute("ws-children-template");ck.set_Item(cu,B.FakeRoot(ct));}cv=new ba.New$3();while(ck.count>0)ci(v.head(ck.get_Keys()));};B.LoadedTemplates=function(){bc.$cctor();return bc.LoadedTemplates;};B.LoadedTemplateFile=function(cg){var ch,ci,cj;ch=(ci=null,[B.LoadedTemplates().TryGetValue(cg,{get:function(){return ci;},set:function(ck){ci=ck;}}),ci]);return ch[0]?ch[1]:(cj=new W.New$5(),(B.LoadedTemplates().set_Item(cg,cj),cj));};B.NamedTemplate=function(cg,ch,ci){var cj,ck;cj=(ck=null,[B.LoadedTemplateFile(cg).TryGetValue(ch==null?"":ch.$0,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);return cj[0]?B.ChildrenTemplate(cj[1].cloneNode(true),ci):(cd.warn("Local template doesn't exist",ch),l.get_Empty());};B.FakeRootSingle=function(cg){var ch,ci,cj,ck;cg.removeAttribute("ws-template");ch=cg.getAttribute("ws-replace");if(ch===null);else{cg.removeAttribute("ws-replace");ci=cg.parentNode;w.Equals(ci,null)?void 0:(cj=self.document.createElement(cg.tagName),cj.setAttribute("ws-replace",ch),ci.replaceChild(cj,cg));}ck=self.document.createElement("div");ck.appendChild(cg);return ck;};B.FakeRoot=function(cg){var ch;ch=self.document.createElement("div");while(cg.hasChildNodes())ch.appendChild(cg.firstChild);return ch;};B.PrepareTemplateStrict=function(cg,ch,ci,cj){var ck;function cl(cr,cs){var ct,cu,cv,cw,cx,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT;function cy(cU){}while(true)switch(cr){case 0:if(cs!==null){ct=cs.nextSibling;if(w.Equals(cs.nodeType,V.TEXT_NODE))br.convertTextNode(cs);else if(w.Equals(cs.nodeType,V.ELEMENT_NODE))cn(cs);cs=ct;}else return null;break;case 1:cz=bs.string(cs.nodeName,{$:1,$0:3},null).toLowerCase();cA=(cu=cz.indexOf("."),cu===-1?[cg,cz]:[bs.string(cz,null,{$:1,$0:cu-1}),bs.string(cz,{$:1,$0:cu+1},null)]);cB=cA[1];cC=cA[0];if(cC!==""&&!B.LoadedTemplates().ContainsKey(cC))return br.failNotLoaded(cB);else{if(cC===""&&cj!=null)cj.$0(cB);cD=B.LoadedTemplates().get_Item(cC);if(!cD.ContainsKey(cB))return br.failNotLoaded(cB);else{cE=cD.get_Item(cB);cF=cE.cloneNode(true);cG=new ba.New$3();cH=new W.New$5();cI=cs.attributes;for(cJ=0,cK=cI.length-1;cJ<=cK;cJ++){cL=cI.item(cJ).name.toLowerCase();cH.set_Item(cL,(cM=cI.item(cJ).nodeValue,cM===""?cL:cM.toLowerCase()));if(!cG.Add(cL))cd.warn("Hole mapped twice",cL);}for(cN=0,cO=cs.childNodes.length-1;cN<=cO;cN++){cP=cs.childNodes[cN];if(w.Equals(cP.nodeType,V.ELEMENT_NODE))!cG.Add(cP.nodeName.toLowerCase())?cd.warn("Hole filled twice",cB):void 0;}cQ=cs.childNodes.length===1&&w.Equals(cs.firstChild.nodeType,V.TEXT_NODE);if(cQ){cw=br.fillTextHole(cF,cs.firstChild.textContent,cB);((function(cU){return function(cV){if(cV!=null)cU(cV.$0);};}((cx=function(cU){return function(cV){return cU.Add(cV);};}(cG),function(cU){return cy(cx(cU));})))(cw));}br.removeHolesExcept(cF,cG);if(!cQ){for(cR=0,cS=cs.childNodes.length-1;cR<=cS;cR++){cT=cs.childNodes[cR];if(w.Equals(cT.nodeType,V.ELEMENT_NODE))cT.hasAttributes()?br.fillInstanceAttrs(cF,cT):cm(cF,cT);}}br.mapHoles(cF,cH);br.fill(cF,cs.parentNode,cs);cs.parentNode.removeChild(cs);return;}}break;}}function cm(cr,cs){var ct,cv,cw;function cu(cx,cy){var cz;if(cv==="title"&&cs.hasChildNodes()){cz=_.ParseHTMLIntoFakeRoot(cs.textContent);cs.removeChild(cs.firstChild);while(cz.hasChildNodes())cs.appendChild(cz.firstChild);}else null;cn(cs);return br.fill(cs,cx,cy);}cv=cs.nodeName.toLowerCase();B.foreachNotPreserved(cr,"[ws-attr-holes]",function(cx){var cy,cz,cA,cB,cC;cy=H.SplitChars(cx.getAttribute("ws-attr-holes"),[" "],1);for(cz=0,cA=cy.length-1;cz<=cA;cz++){cB=q.get(cy,cz);cx.setAttribute(cB,(cC=new a.RegExp("\\${"+cv+"}","ig"),cx.getAttribute(cB).replace(cC,cs.textContent)));}});cw=cr.querySelector("[ws-hole="+cv+"]");if(w.Equals(cw,null)){ct=cr.querySelector("[ws-replace="+cv+"]");return w.Equals(ct,null)?null:(cu(ct.parentNode,ct),void ct.parentNode.removeChild(ct));}else{while(cw.hasChildNodes())cw.removeChild(cw.lastChild);cw.removeAttribute("ws-hole");return cu(cw,null);}}function cn(cr){if(!cr.hasAttribute("ws-preserve"))if(H.StartsWith(cr.nodeName.toLowerCase(),"ws-"))cp(cr);else{br.convertAttrs(cr);co(cr.firstChild);}}function co(cr){return cl(0,cr);}function cp(cr){return cl(1,cr);}function cq(cr){var cs,ct,cu,cv;while(true){cs=cr.querySelector("[ws-template]");if(w.Equals(cs,null)){ct=cr.querySelector("[ws-children-template]");if(w.Equals(ct,null))return null;else{cu=ct.getAttribute("ws-children-template");ct.removeAttribute("ws-children-template");B.PrepareTemplateStrict(cg,{$:1,$0:cu},ct,null);cr=cr;}}else{cv=cs.getAttribute("ws-template");(B.PrepareSingleTemplate(cg,{$:1,$0:cv},cs))(null);cr=cr;}}}ck=(ch==null?"":ch.$0).toLowerCase();B.LoadedTemplateFile(cg).set_Item(ck,ci);if(ci.hasChildNodes()){cq(ci);co(ci.firstChild);}};B.ChildrenTemplate=function(cg,ch){var ci,cj,ck,cl,cm;ci=B.InlineTemplate(cg,v.append(ch,B.GlobalHoles().get_Values()));cj=ci[1];ck=ci[0];cl=ck.Els;return!w.Equals(cl,null)&&cl.length===1&&(q.get(cl,0)instanceof V&&(w.Equals(q.get(cl,0).nodeType,V.ELEMENT_NODE)&&(cm=q.get(cl,0),true)))?bE.TreeNode(ck,cj):l.Mk({$:6,$0:ck},cj);};B.foreachNotPreserved=function(cg,ch,ci){_.IterSelector(cg,ch,function(cj){if(cj.closest("[ws-preserve]")==null)ci(cj);});};B.PrepareSingleTemplate=function(cg,ch,ci){var cj;cj=B.FakeRootSingle(ci);return function(ck){B.PrepareTemplateStrict(cg,ch,cj,ck);};};B.InlineTemplate=function(cg,ch){var ci,cj,ck,cl,co,cp,cq,cr,cs,ct,cu;function cm(cv,cw){var cx,cy,cz;cx=_9.Insert(cv,cw);cp.push(_9.Updates(cx));cq.push([cv,cx]);cy=cc.GetOptional(cx.OnAfterRender);return cy==null?null:(cz=cy.$0,void cr.push(function(){cz(cv);}));}function cn(cv){var cw,cx;cw=(cx=null,[cs.TryGetValue(cv,{get:function(){return cx;},set:function(cy){cx=cy;}}),cx]);return cw[0]?cw[1].$==0?{$:1,$0:cw[1].$1}:cw[1].$==1?{$:1,$0:l.TextNode(cw[1].$1)}:cw[1].$==2?{$:1,$0:l.TextView(cw[1].$1)}:cw[1].$==8?{$:1,$0:l.TextView(cw[1].$1.get_View())}:cw[1].$==9?{$:1,$0:l.TextView(u.Map(a.String,cw[1].$1.get_View()))}:cw[1].$==10?{$:1,$0:l.TextView(u.Map(function(cy){return cy.get_Input();},cw[1].$1.get_View()))}:cw[1].$==11?{$:1,$0:l.TextView(u.Map(a.String,cw[1].$1.get_View()))}:cw[1].$==12?{$:1,$0:l.TextView(u.Map(function(cy){return cy.get_Input();},cw[1].$1.get_View()))}:cw[1].$==13?{$:1,$0:l.TextView(u.Map(a.String,cw[1].$1.get_View()))}:(cd.warn("Content hole filled with attribute data",cv),null):null;}co=[];cp=[];cq=[];cr=[];cs=new W.New$5();ct=$.Get(ch);try{while(ct.MoveNext()){cu=ct.Current();cs.set_Item(cu.$0,cu);}}finally{if(typeof ct=="object"&&"Dispose"in ct)ct.Dispose();}ci=_.ChildrenArray(cg);B.foreachNotPreserved(cg,"[ws-hole]",function(cv){var cw,cx,cy;cy=cv.getAttribute("ws-hole");cv.removeAttribute("ws-hole");while(cv.hasChildNodes())cv.removeChild(cv.lastChild);cw=cn(cy);if(cw!=null&&cw.$==1){cx=cw.$0;_5.LinkElement(cv,cx.docNode);co.push(bl.New(_9.Empty(cv),cx.docNode,null,cv,bj.Int(),null));cp.push(cx.updates);}});B.foreachNotPreserved(cg,"[ws-replace]",function(cv){var cw,cx,cy,cz,cA,cB;cw=cn(cv.getAttribute("ws-replace"));if(cw!=null&&cw.$==1){cx=cw.$0;cy=cv.parentNode;cz=self.document.createTextNode("");cy.replaceChild(cz,cv);cA=_5.InsertBeforeDelim(cz,cx.docNode);cB=q.tryFindIndex(function(cC){return cv===cC;},ci);cB==null?void 0:q.set(ci,cB.$0,cx.docNode);co.push(bl.New(_9.Empty(cy),cx.docNode,{$:1,$0:[cA,cz]},cy,bj.Int(),null));cp.push(cx.updates);}});B.foreachNotPreserved(cg,"[ws-attr]",function(cv){var cw,cx,cy;cw=cv.getAttribute("ws-attr");cv.removeAttribute("ws-attr");cx=(cy=null,[cs.TryGetValue(cw,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy]);if(cx[0])cx[1].$==3?cm(cv,cx[1].$1):cd.warn("Attribute hole filled with non-attribute data",cw);});B.foreachNotPreserved(cg,"[ws-on]",function(cv){cm(cv,_4.Concat(q.choose(function(cw){var cx,cy,cz;cx=H.SplitChars(cw,[":"],1);cy=(cz=null,[cs.TryGetValue(q.get(cx,1),{get:function(){return cz;},set:function(cA){cz=cA;}}),cz]);return cy[0]?cy[1].$==4?{$:1,$0:S.Handler(q.get(cx,0),cy[1].$1)}:cy[1].$==5?{$:1,$0:_4.Handler(q.get(cx,0),cy[1].$1)}:(cd.warn("Event hole on"+q.get(cx,0)+" filled with non-event data",q.get(cx,1)),null):null;},H.SplitChars(cv.getAttribute("ws-on"),[" "],1))));cv.removeAttribute("ws-on");});B.foreachNotPreserved(cg,"[ws-onafterrender]",function(cv){var cw,cx,cy;cw=cv.getAttribute("ws-onafterrender");cx=(cy=null,[cs.TryGetValue(cw,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy]);if(cx[0])cx[1].$==6?(cv.removeAttribute("ws-onafterrender"),cm(cv,S.OnAfterRender(cx[1].$1))):cx[1].$==7?(cv.removeAttribute("ws-onafterrender"),cm(cv,S.OnAfterRender(cx[1].$1))):cd.warn("onafterrender hole filled with non-onafterrender data",cw);});B.foreachNotPreserved(cg,"[ws-var]",function(cv){var cw,cx,cy;cw=cv.getAttribute("ws-var");cv.removeAttribute("ws-var");cx=(cy=null,[cs.TryGetValue(cw,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy]);if(cx[0])cx[1].$==8?cm(cv,S.Value(cx[1].$1)):cx[1].$==9?cm(cv,S.Checked(cx[1].$1)):cx[1].$==10?cm(cv,S.IntValue(cx[1].$1)):cx[1].$==11?cm(cv,S.IntValueUnchecked(cx[1].$1)):cx[1].$==12?cm(cv,S.FloatValue(cx[1].$1)):cx[1].$==13?cm(cv,S.FloatValueUnchecked(cx[1].$1)):cd.warn("Var hole filled with non-Var data",cw);});B.foreachNotPreserved(cg,"[ws-attr-holes]",function(cv){var cw,cx,cy,cz;cw=new a.RegExp(B.TextHoleRE(),"g");cx=H.SplitChars(cv.getAttribute("ws-attr-holes"),[" "],1);cv.removeAttribute("ws-attr-holes");for(cy=0,cz=cx.length-1;cy<=cz;cy++)(function(){var cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM;cJ=q.get(cx,cy);cK=cv.getAttribute(cJ);cA=null;cB=0;cL=[];while(cA=cw.exec(cK),cA!==null){cM=bs.string(cK,{$:1,$0:cB},{$:1,$0:cw.lastIndex-q.get(cA,0).length-1});cB=cw.lastIndex;cL.push([cM,q.get(cA,1)]);}cD=bs.string(cK,{$:1,$0:cB},null);cw.lastIndex=0;cE=q.foldBack(function(cN,cO){return(function(cP){var cQ,cR;cQ=cP[0];cR=cP[1];return function(cS){var cT,cU,cV,cW,cX;cT=cS[0];cU=cS[1];cV=(cW=(cX=null,[cs.TryGetValue(cR,{get:function(){return cX;},set:function(cY){cX=cY;}}),cX]),cW[0]?cW[1].$==1?{$:0,$0:cW[1].$1}:cW[1].$==2?{$:1,$0:cW[1].$1}:cW[1].$==8?{$:1,$0:cW[1].$1.get_View()}:cW[1].$==9?{$:1,$0:u.Map(a.String,cW[1].$1.get_View())}:cW[1].$==10?{$:1,$0:u.Map(function(cY){return cY.get_Input();},cW[1].$1.get_View())}:cW[1].$==11?{$:1,$0:u.Map(a.String,cW[1].$1.get_View())}:cW[1].$==12?{$:1,$0:u.Map(function(cY){return cY.get_Input();},cW[1].$1.get_View())}:cW[1].$==13?{$:1,$0:u.Map(a.String,cW[1].$1.get_View())}:(cd.warn("Attribute value hole filled with non-text data",cR),{$:0,$0:""}):{$:0,$0:""});return cV.$==1?[cQ,new Q({$:1,$0:cT===""?cV.$0:u.Map(function(cY){return cY+cT;},cV.$0),$1:cU})]:[cQ+cV.$0+cT,cU];};}(cN))(cO);},cL,[cD,Q.Empty]);return cm(cv,cE[1].$==1?cE[1].$1.$==1?cE[1].$1.$1.$==1?cE[1].$1.$1.$1.$==0?(cF=cE[0],S.Dynamic(cJ,u.Map3(function(cN,cO,cP){return cF+cN+cO+cP;},cE[1].$0,cE[1].$1.$0,cE[1].$1.$1.$0))):(cG=cE[0],S.Dynamic(cJ,u.Map(function(cN){return cG+H.concat("",cN);},u.Sequence(cE[1])))):(cH=cE[0],S.Dynamic(cJ,u.Map2(function(cN,cO){return cH+cN+cO;},cE[1].$0,cE[1].$1.$0))):cE[0]===""?S.Dynamic(cJ,cE[1].$0):(cI=cE[0],S.Dynamic(cJ,u.Map(function(cN){return cI+cN;},cE[1].$0))):_4.Create(cJ,cE[0]));}());});return[cc.DeleteEmptyFields({Els:ci,Dirty:true,Holes:co,Attrs:cq,Render:(cj=cr.length==0?null:{$:1,$0:function(cv){q.iter(function(cw){cw(cv);},cr);}},cj?cj.$0:void 0),El:(ck=!w.Equals(ci,null)&&ci.length===1&&(q.get(ci,0)instanceof V&&(q.get(ci,0)instanceof a.Element&&(cl=q.get(ci,0),true)))?{$:1,$0:cl}:null,ck?ck.$0:void 0)},["Render","El"]),_3.TreeReduce(u.Const(),u.Map2Unit,cp)];};B.GlobalHoles=function(){bc.$cctor();return bc.GlobalHoles;};B.TextHoleRE=function(){bc.$cctor();return bc.TextHoleRE;};C.Install=function(cg,ch){var ci;ci=D.Create$1(void 0);C.InstallInto(ci,cg,ch);return ci;};C.InstallInto=function(cg,ch,ci){function cj(cm){return Z.Parse(ci,cm);}function ck(){return C.getCurrent(cj,ch);}function cl(cm){if(!w.Equals(cg.Get(),cm))cg.Set(cm);}cl(ck());self.addEventListener("popstate",function(){return cl(ck());},false);self.document.body.addEventListener("click",function(cm){var cn,co,cp;cn=(co=(cp=C.findLinkHref(cm.target),cp==null?null:C.hrefToAbsolute(cp.$0)),co==null?null:cj(bf.FromUrl(co.$0,null)));return cn==null?null:(cl(cn.$0),cm.preventDefault());},false);u.Sink(function(cm){var cn;if(!w.Equals(cm,ck())){cn=Z.Link(ci,cm);self.history.pushState(null,null,cn);}},cg.get_View());};C.getCurrent=function(cg,ch){var ci,cj,ck;ci=self.location;cj=bf.FromUrl(ci.pathname+ci.search,null);ck=cg(cj);return ck==null?((function(cl){return function(cm){return cl("Failed to parse route: "+I.toSafe(cm));};}(function(cl){cd.log(cl);}))(cj.ToLink()),ch):ck.$0;};C.findLinkHref=function(cg){while(true)if(cg.tagName==="A")return bh.ofObj(cg.getAttribute("href"));else if(cg===self.document.body)return null;else cg=cg.parentNode;};C.hrefToAbsolute=function(cg){var ch;return H.StartsWith(cg,"?")?{$:1,$0:C.trimFragment(self.location.pathname+cg)}:H.StartsWith(cg,"#")?null:H.StartsWith(cg,"/")?{$:1,$0:C.trimFragment(cg)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(cg)?null:(ch=self.location.pathname,{$:1,$0:C.trimFragment(bs.string(ch,null,{$:1,$0:ch.lastIndexOf("/")})+cg)});};C.trimFragment=function(cg){var ch;ch=cg.indexOf("#");return ch===-1?cg:bs.string(cg,null,{$:1,$0:ch-1});};D=g.Var$1=cc.Class({},f,D);D.Create$1=function(cg){return new _0.New(false,T.New({$:2,$0:cg,$1:[]}),cg);};D.Create=function(){return new _0.New(false,T.New({$:2,$0:null,$1:[]}),null);};F.YieldVar=function(cg){return F.New(cg.get_Id(),u.Map(function(ch){return{$:0,$0:ch};},cg.get_View()),function(ch){return ch(cg);});};F.WithSubmit=function(cg){var ch;ch=new L.New(cg.view,{$:1,$0:Q.Empty});return F.New(_2.Id(),ch.view,function(ci){return(cg.render(ci))(ch);});};F.Run=function(cg,ch){return F.Map(function(ci){cg(ci);return ci;},ch);};F.Render=function(cg,ch){var ci;ci=ch.render(cg);return l.Append(l.EmbedView(u.Map(function(){return l.get_Empty();},ch.view)),ci);};F.Map=function(cg,ch){return F.MapResult(function(ci){return bk.Map(cg,ci);},ch);};F.MapResult=function(cg,ch){return F.New(ch.id,u.Map(cg,ch.view),ch.render);};G.GetFieldValues=function(cg){var ch,ci;ch=[];for(var cj in cg)ch.push(cg[cj]);return ch;};H.concat=function(cg,ch){return q.ofSeq(ch).join(cg);};H.SplitChars=function(cg,ch,ci){return H.Split(cg,new a.RegExp("["+H.RegexEscape(ch.join(""))+"]"),ci);};H.StartsWith=function(cg,ch){return cg.substring(0,ch.length)==ch;};H.Substring=function(cg,ch,ci){return cg.substr(ch,ci);};H.Split=function(cg,ch,ci){return ci===1?q.filter(function(cj){return cj!=="";},H.SplitWith(cg,ch)):H.SplitWith(cg,ch);};H.RegexEscape=function(cg){return cg.replace(new a.RegExp("[-\\/\\\\^$*+?.()|[\\]{}]","g"),"\\$&");};H.SplitWith=function(cg,ch){return cg.split(ch);};H.IsNullOrEmpty=function(cg){return cg==null||cg=="";};H.Join=function(cg,ch){return ch.join(cg);};H.forall=function(cg,ch){return v.forall(cg,H.protect(ch));};H.protect=function(cg){return cg===null?"":cg;};I.toSafe=function(cg){return cg==null?"":cg;};K=J.attr=cc.Class({},f,K);L=g.Submitter=cc.Class({Trigger:function(){this["var"].Set(null);}},f,L);L.New=cc.Ctor(function(cg,ch){f.New.call(this);this.input=cg;this["var"]=D.Create();this.view=u.SnapshotOn(ch,this["var"].get_View(),this.input);},L);F.New=function(cg,ch,ci){return{id:cg,view:ch,render:ci};};N.NewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(new a.RegExp("[xy]","g"),function(cg){var ch,ci;ch=ce.random()*16|0;ci=cg=="x"?ch:ch&3|8;return ci.toString(16);});};P=O.List=cc.Class({GetEnumerator:function(){return $.Get(this);},GetEnumerator0:function(){return $.Get0(this);}},null,P);Q=s.T=cc.Class({GetEnumerator:function(){return new bq.New(this,null,function(cg){var ch;ch=cg.s;return ch.$==0?false:(cg.c=ch.$0,cg.s=ch.$1,true);},void 0);},GetEnumerator0:function(){return $.Get(this);}},null,Q);Q.Empty=new Q({$:0});R=O.FSharpSet=cc.Class({Add:function(cg){return new R.New$1(_1.Add(cg,this.tree));},Remove:function(cg){return new R.New$1(_1.Remove(cg,this.tree));},GetEnumerator$1:function(){return $.Get(_1.Enumerate(false,this.tree));},Equals:function(cg){return this.get_Count()===cg.get_Count()&&v.forall2(w.Equals,this,cg);},get_Count:function(){var cg;cg=this.tree;return cg==null?0:cg.Count;},GetHashCode:function(){return -1741749453+w.Hash(q.ofSeq(this));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();},CompareTo0:function(cg){return v.compareWith(w.Compare,this,cg);}},f,R);R.New$1=cc.Ctor(function(cg){f.New.call(this);this.tree=cg;},R);S.DynamicPred=function(cg,ch,ci){function cj(ck,cl){return cl[0]?ck.setAttribute(cg,cl[1]):ck.removeAttribute(cg);}return _9.Dynamic(u.Map2(function(ck,cl){return[ck,cl];},ch,ci),function(ck){return function(cl){return cj(ck,cl);};});};S.Handler=function(cg,ch){return _9.Static(function(ci){ci.addEventListener(cg,function(cj){return(ch(ci))(cj);},false);});};S.OnAfterRender=function(cg){return new _4({$:4,$0:cg});};S.Value=function(cg){return S.ValueWith(bZ.StringApply(),cg);};S.Checked=function(cg){return S.ValueWith(bZ.BoolCheckedApply(),cg);};S.IntValue=function(cg){return S.ValueWith(bZ.IntApplyChecked(),cg);};S.IntValueUnchecked=function(cg){return S.ValueWith(bZ.IntApplyUnchecked(),cg);};S.FloatValue=function(cg){return S.ValueWith(bZ.FloatApplyChecked(),cg);};S.FloatValueUnchecked=function(cg){return S.ValueWith(bZ.FloatApplyUnchecked(),cg);};S.Dynamic=function(cg,ch){return _9.Dynamic(ch,function(ci){return function(cj){return ci.setAttribute(cg,cj);};});};S.ValueWith=function(cg,ch){var ci;ci=cg(ch);return _4.Append(_9.Static(ci[0]),S.DynamicCustom(ci[1],ci[2]));};S.DynamicCustom=function(cg,ch){return _9.Dynamic(ch,cg);};v.contains=function(cg,ch){var ci,cj;ci=$.Get(ch);try{cj=false;while(!cj&&ci.MoveNext())cj=w.Equals(ci.Current(),cg);return cj;}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}};v.insufficient=function(){return e.FailWith("The input sequence has an insufficient number of elements.");};q.mapiInPlace=function(cg,ch){var ci,cj;for(ci=0,cj=ch.length-1;ci<=cj;ci++)ch[ci]=cg(ci,ch[ci]);return ch;};q.mapInPlace=function(cg,ch){var ci,cj;for(ci=0,cj=ch.length-1;ci<=cj;ci++)ch[ci]=cg(ch[ci]);};T.Map=function(cg,ch){var ci,cj;ci=ch.s;return ci!=null&&ci.$==0?T.New({$:0,$0:cg(ci.$0)}):(cj=T.New({$:3,$0:[],$1:[]}),(T.When(ch,function(ck){T.MarkDone(cj,ch,cg(ck));},cj),cj));};T.WhenObsoleteRun=function(cg,ch){var ci;ci=cg.s;if(ci==null)ch();else ci!=null&&ci.$==2?ci.$1.push(ch):ci!=null&&ci.$==3?ci.$1.push(ch):void 0;};T.When=function(cg,ch,ci){var cj;cj=cg.s;if(cj==null)T.Obsolete(ci);else cj!=null&&cj.$==2?(T.EnqueueSafe(cj.$1,ci),ch(cj.$0)):cj!=null&&cj.$==3?(cj.$0.push(ch),T.EnqueueSafe(cj.$1,ci)):ch(cj.$0);};T.MarkDone=function(cg,ch,ci){var cj;if(cj=ch.s,cj!=null&&cj.$==0)T.MarkForever(cg,ci);else T.MarkReady(cg,ci);};T.Map2=function(cg,ch,ci){var cj,ck,cl;function cm(cn){var co,cp,cq;if(!(co=cl.s,co!=null&&co.$==0||co!=null&&co.$==2)){cp=T.ValueAndForever(ch);cq=T.ValueAndForever(ci);if(cp!=null&&cp.$==1)cq!=null&&cq.$==1?cp.$0[1]&&cq.$0[1]?T.MarkForever(cl,cg(cp.$0[0],cq.$0[0])):T.MarkReady(cl,cg(cp.$0[0],cq.$0[0])):void 0;}}cj=ch.s;ck=ci.s;return cj!=null&&cj.$==0?ck!=null&&ck.$==0?T.New({$:0,$0:cg(cj.$0,ck.$0)}):T.Map2Opt1(cg,cj.$0,ci):ck!=null&&ck.$==0?T.Map2Opt2(cg,ck.$0,ch):(cl=T.New({$:3,$0:[],$1:[]}),(T.When(ch,cm,cl),T.When(ci,cm,cl),cl));};T.WhenRun=function(cg,ch,ci){var cj;cj=cg.s;if(cj==null)ci();else cj!=null&&cj.$==2?(cj.$1.push(ci),ch(cj.$0)):cj!=null&&cj.$==3?(cj.$0.push(ch),cj.$1.push(ci)):ch(cj.$0);};T.Map2Unit=function(cg,ch){var ci,cj,ck;function cl(){var cm,cn,co;if(!(cm=ck.s,cm!=null&&cm.$==0||cm!=null&&cm.$==2)){cn=T.ValueAndForever(cg);co=T.ValueAndForever(ch);if(cn!=null&&cn.$==1)co!=null&&co.$==1?cn.$0[1]&&co.$0[1]?T.MarkForever(ck,null):T.MarkReady(ck,null):void 0;}}ci=cg.s;cj=ch.s;return ci!=null&&ci.$==0?cj!=null&&cj.$==0?T.New({$:0,$0:null}):ch:cj!=null&&cj.$==0?cg:(ck=T.New({$:3,$0:[],$1:[]}),(T.When(cg,cl,ck),T.When(ch,cl,ck),ck));};T.Join=function(cg){var ch;ch=T.New({$:3,$0:[],$1:[]});T.When(cg,function(ci){var cj;cj=ci();T.When(cj,function(ck){var cl,cm;if((cl=cj.s,cl!=null&&cl.$==0)&&(cm=cg.s,cm!=null&&cm.$==0))T.MarkForever(ch,ck);else T.MarkReady(ch,ck);},ch);},ch);return ch;};T.EnqueueSafe=function(cg,ch){var ci,cj,ck,cl;cg.push(ch);if(cg.length%20===0){ci=cg.slice(0);bY.Clear(cg);for(cj=0,ck=q.length(ci)-1;cj<=ck;cj++){cl=q.get(ci,cj);if(typeof cl=="object")(function(cm){if(cm.s)cg.push(cm);}(cl));else(function(cm){cg.push(cm);}(cl));}}else void 0;};T.MarkForever=function(cg,ch){var ci,cj,ck,cl;ci=cg.s;if(ci!=null&&ci.$==3){cg.s={$:0,$0:ch};cj=ci.$0;for(ck=0,cl=q.length(cj)-1;ck<=cl;ck++)(q.get(cj,ck))(ch);}else void 0;};T.MarkReady=function(cg,ch){var ci,cj,ck,cl;ci=cg.s;if(ci!=null&&ci.$==3){cg.s={$:2,$0:ch,$1:ci.$1};cj=ci.$0;for(ck=0,cl=q.length(cj)-1;ck<=cl;ck++)(q.get(cj,ck))(ch);}else void 0;};T.Map2Opt1=function(cg,ch,ci){return T.Map(function(cj){return cg(ch,cj);},ci);};T.Map2Opt2=function(cg,ch,ci){return T.Map(function(cj){return cg(cj,ch);},ci);};T.ValueAndForever=function(cg){var ch;ch=cg.s;return ch!=null&&ch.$==0?{$:1,$0:[ch.$0,true]}:ch!=null&&ch.$==2?{$:1,$0:[ch.$0,false]}:null;};T.SnapshotOn=function(cg,ch){var ci;function cj(ck){var cl,cm,cn;if(!(cl=ci.s,cl!=null&&cl.$==0||cl!=null&&cl.$==2)){cm=T.ValueAndForever(cg);cn=T.ValueAndForever(ch);if(cm!=null&&cm.$==1)cn!=null&&cn.$==1?cm.$0[1]||cn.$0[1]?T.MarkForever(ci,cn.$0[0]):T.MarkReady(ci,cn.$0[0]):void 0;}}ci=T.New({$:3,$0:[],$1:[]});T.When(cg,cj,ci);T.WhenReady(ch,cj);return ci;};T.WhenObsolete=function(cg,ch){var ci;ci=cg.s;if(ci==null)T.Obsolete(ch);else ci!=null&&ci.$==2?T.EnqueueSafe(ci.$1,ch):ci!=null&&ci.$==3?T.EnqueueSafe(ci.$1,ch):void 0;};T.WhenReady=function(cg,ch){var ci,cj;cj=cg.s;switch(cj!=null&&cj.$==2?(ci=cj.$0,0):cj==null?1:cj!=null&&cj.$==3?2:(ci=cj.$0,0)){case 0:ch(ci);break;case 1:null;break;case 2:cj.$0.push(ch);break;}};T.Map3=function(cg,ch,ci,cj){var ck,cl,cm,cn;function co(cp){var cq,cr,cs,ct;if(!(cq=cn.s,cq!=null&&cq.$==0||cq!=null&&cq.$==2)){cr=T.ValueAndForever(ch);cs=T.ValueAndForever(ci);ct=T.ValueAndForever(cj);if(cr!=null&&cr.$==1)cs!=null&&cs.$==1?ct!=null&&ct.$==1?cr.$0[1]&&cs.$0[1]&&ct.$0[1]?T.MarkForever(cn,cg(cr.$0[0],cs.$0[0],ct.$0[0])):T.MarkReady(cn,cg(cr.$0[0],cs.$0[0],ct.$0[0])):void 0:void 0;}}ck=ch.s;cl=ci.s;cm=cj.s;return ck!=null&&ck.$==0?cl!=null&&cl.$==0?cm!=null&&cm.$==0?T.New({$:0,$0:cg(ck.$0,cl.$0,cm.$0)}):T.Map3Opt1(cg,ck.$0,cl.$0,cj):cm!=null&&cm.$==0?T.Map3Opt2(cg,ck.$0,cm.$0,ci):T.Map3Opt3(cg,ck.$0,ci,cj):cl!=null&&cl.$==0?cm!=null&&cm.$==0?T.Map3Opt4(cg,cl.$0,cm.$0,ch):T.Map3Opt5(cg,cl.$0,ch,cj):cm!=null&&cm.$==0?T.Map3Opt6(cg,cm.$0,ch,ci):(cn=T.New({$:3,$0:[],$1:[]}),(T.When(ch,co,cn),T.When(ci,co,cn),T.When(cj,co,cn),cn));};T.Sequence=function(cg){var ch,ci,cj;function ck(cl){var cm;if(cj[0]===0){cm=q.map(function(cn){var co;co=cn.s;return co!=null&&co.$==0?co.$0:co!=null&&co.$==2?co.$0:e.FailWith("value not found by View.Sequence");},ch);if(q.forall(function(cn){var co;co=cn.s;return co!=null&&co.$==0;},ch))T.MarkForever(ci,cm);else T.MarkReady(ci,cm);}else cj[0]--;}ch=q.ofSeq(cg);return ch.length==0?T.New({$:0,$0:[]}):(ci=T.New({$:3,$0:[],$1:[]}),(cj=[q.length(ch)-1],(q.iter(function(cl){T.When(cl,ck,ci);},ch),ci)));};T.Copy=function(cg){var ch,ci,cj;ch=cg.s;return ch==null?cg:ch!=null&&ch.$==2?(ci=T.New({$:2,$0:ch.$0,$1:[]}),(T.WhenObsolete(cg,ci),ci)):ch!=null&&ch.$==3?(cj=T.New({$:3,$0:[],$1:[]}),(T.When(cg,function(ck){T.MarkDone(cj,cg,ck);},cj),cj)):cg;};T.Map3Opt1=function(cg,ch,ci,cj){return T.Map(function(ck){return cg(ch,ci,ck);},cj);};T.Map3Opt2=function(cg,ch,ci,cj){return T.Map(function(ck){return cg(ch,ck,ci);},cj);};T.Map3Opt3=function(cg,ch,ci,cj){return T.Map2(function(ck,cl){return cg(ch,ck,cl);},ci,cj);};T.Map3Opt4=function(cg,ch,ci,cj){return T.Map(function(ck){return cg(ck,ch,ci);},cj);};T.Map3Opt5=function(cg,ch,ci,cj){return T.Map2(function(ck,cl){return cg(ck,ch,cl);},ci,cj);};T.Map3Opt6=function(cg,ch,ci,cj){return T.Map2(function(ck,cl){return cg(ck,cl,ch);},ci,cj);};W=O.Dictionary=cc.Class({set_Item:function(cg,ch){this.set(cg,ch);},ContainsKey:function(cg){var ch,ci;ch=this;ci=this.data[this.hash(cg)];return ci==null?false:q.exists(function(cj){return ch.equals.apply(null,[(e.KeyValue(cj))[0],cg]);},ci);},TryGetValue:function(cg,ch){var ci,cj,ck;ci=this;cj=this.data[this.hash(cg)];return cj==null?false:(ck=q.tryPick(function(cl){var cm;cm=e.KeyValue(cl);return ci.equals.apply(null,[cm[0],cg])?{$:1,$0:cm[1]}:null;},cj),ck!=null&&ck.$==1&&(ch.set(ck.$0),true));},Remove:function(cg){return this.remove(cg);},get_Keys:function(){return new bt.New(this);},set:function(cg,ch){var ci,cj,ck,cl;ci=this;cj=this.hash(cg);ck=this.data[cj];if(ck==null){this.count=this.count+1;this.data[cj]=new a.Array({K:cg,V:ch});}else{cl=q.tryFindIndex(function(cm){return ci.equals.apply(null,[(e.KeyValue(cm))[0],cg]);},ck);cl==null?(this.count=this.count+1,ck.push({K:cg,V:ch})):ck[cl.$0]={K:cg,V:ch};}},remove:function(cg){var ch,ci,cj,ck;ch=this;ci=this.hash(cg);cj=this.data[ci];return cj==null?false:(ck=q.filter(function(cl){return!ch.equals.apply(null,[(e.KeyValue(cl))[0],cg]);},cj),q.length(ck)<cj.length&&(this.count=this.count-1,this.data[ci]=ck,true));},get_Item:function(cg){return this.get(cg);},get_Values:function(){return new bP.New(this);},get:function(cg){var ch,ci;ch=this;ci=this.data[this.hash(cg)];return ci==null?bp.notPresent():q.pick(function(cj){var ck;ck=e.KeyValue(cj);return ch.equals.apply(null,[ck[0],cg])?{$:1,$0:ck[1]}:null;},ci);},GetEnumerator:function(){return $.Get0(this);},GetEnumerator0:function(){return $.Get0(q.concat(G.GetFieldValues(this.data)));}},f,W);W.New$5=cc.Ctor(function(){W.New$6.call(this,[],w.Equals,w.Hash);},W);W.New$6=cc.Ctor(function(cg,ch,ci){var cj,ck;f.New.call(this);this.equals=ch;this.hash=ci;this.count=0;this.data=[];cj=$.Get(cg);try{while(cj.MoveNext()){ck=cj.Current();this.set(ck.K,ck.V);}}finally{if(typeof cj=="object"&&"Dispose"in cj)cj.Dispose();}},W);Y.JSUnion=function(cg,ch){var ci;function cj(cn){var co;function cp(cq){return cq!=null&&cq.$==1&&w.Equals(cn,cq.$0);}co=v.tryFindIndex(function(cq){return cp(cq[0]);},ch);return co!=null&&co.$==1?co.$0:cn.$;}function ck(cn,co){return q.init(q.length((q.get(ch,cn))[2]),function(cp){return co["$"+a.String(cp)];});}function cl(cn,co){var cp,cq,cr;cp=cg==null?{}:new cg();cq=q.get(ch,cn);return(cr=cq[0],cr!=null&&cr.$==1)?cq[0].$0:(cp.$=cn,v.iteri(function(cs,ct){cp["$"+a.String(cs)]=ct;},co),cp);}function cm(cn,co){var cp;function cq(cr,cs){return[cn,cr,cs,cp];}cp=co[2];return v.map(function(cr){return cq(cr[0],cr[1]);},co[1]);}ci=q.ofSeq(v.collect(function(cn){return cm(cn[0],cn[1]);},v.indexed(ch)));return be.New$1(function(cn){function co(cp,cq,cr,cs){var ct,cu,cv;function cw(cx){return function(cy){return function(cz){var cA;function cB(cC,cD){return((cw(cA))(cC))(new Q({$:1,$0:cD,$1:cz}));}return cx.$==1?(cA=cx.$1,v.collect(function(cC){return cB(cC[0],cC[1]);},cx.$0.Parse(cy))):[[cy,cl(cp,q.ofList(s.rev(cz)))]];};};}return Y.isCorrectMethod(cq,cn.Method)?(ct=bg.startsWith(s.ofArray(cr),cn.Segments),ct==null?[]:(cu=ct.$0,(cv=s.ofArray(cs),cv.$==0?[[bf.New(cu,cn.QueryArgs,cn.FormData,cn.Method,cn.Body),cl(cp,[])]]:((cw(cv))(bf.New(cu,cn.QueryArgs,cn.FormData,cn.Method,cn.Body)))(Q.Empty)))):[];}return v.collect(function(cp){return co(cp[0],cp[1],cp[2],cp[3]);},ci);},function(cn){var co,cp,cq,cr,cs,ct;function cu(cv,cw){return cw.Write(cv);}co=cj(cn);cp=q.get(ch,co);cq=cp[2];cr=q.get(cp[1],0);cs=[bf.Segment(s.ofArray(cr[1]),cr[0])];return cq.length==0?{$:1,$0:cs}:(ct=(((cc.Curried3(q.map2))(cu))(ck(co,cn)))(cq),q.forall(function(cv){return cv!=null;},ct)?{$:1,$0:v.append(cs,v.collect(function(cv){return cv.$0;},ct))}:null);});};Y.isCorrectMethod=function(cg,ch){return ch!=null&&ch.$==1?cg!=null&&cg.$==1?w.Equals(ch.$0,cg.$0):true:!(cg!=null&&cg.$==1);};Z.Parse=function(cg,ch){function ci(cj,ck){return cj.Segments.$==0?{$:1,$0:ck}:null;}return v.tryPick(function(cj){return ci(cj[0],cj[1]);},cg.Parse(ch));};Z.Link=function(cg,ch){var ci;ci=Z.Write(cg,ch);return ci==null?"":ci.$0.ToLink();};Z.Write=function(cg,ch){var ci;ci=cg.Write(ch);return ci==null?null:{$:1,$0:bf.Combine(ci.$0)};};_0=g.ConcreteVar=cc.Class({get_View:function(){return this.view;},Update:function(cg){this.Set(cg(this.Get()));},Set:function(cg){if(this.isConst)(function(ch){return ch("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(ch){cd.log(ch);}));else{T.Obsolete(this.snap);this.current=cg;this.snap=T.New({$:2,$0:cg,$1:[]});}},get_Id:function(){return"uinref"+a.String(this.id);},Get:function(){return this.current;},UpdateMaybe:function(cg){var ch;ch=cg(this.Get());if(ch!=null&&ch.$==1)this.Set(ch.$0);}},h,_0);_0.New=cc.Ctor(function(cg,ch,ci){var cj;cj=this;h.New.call(this);this.isConst=cg;this.current=ci;this.snap=ch;this.view=function(){return cj.snap;};this.id=bj.Int();},_0);_1.Add=function(cg,ch){return _1.Put(function(ci,cj){return cj;},cg,ch);};_1.Remove=function(cg,ch){var ci,cj,ck,cl;ci=_1.Lookup(cg,ch);cj=ci[0];ck=ci[1];return cj==null?ch:cj.Right==null?_1.Rebuild(ck,cj.Left):cj.Left==null?_1.Rebuild(ck,cj.Right):_1.Rebuild(ck,(cl=q.ofSeq(v.append(_1.Enumerate(false,cj.Left),_1.Enumerate(false,cj.Right))),_1.Build(cl,0,cl.length-1)));};_1.Put=function(cg,ch,ci){var cj,ck;cj=_1.Lookup(ch,ci);ck=cj[0];return ck==null?_1.Rebuild(cj[1],_1.Branch(ch,null,null)):_1.Rebuild(cj[1],_1.Branch(cg(ck.Node,ch),ck.Left,ck.Right));};_1.Lookup=function(cg,ch){var ci,cj,ck,cl;ci=[];cj=ch;ck=true;while(ck)if(cj==null)ck=false;else{cl=w.Compare(cg,cj.Node);if(cl===0)ck=false;else cl===1?(ci.unshift([true,cj.Node,cj.Left]),cj=cj.Right):(ci.unshift([false,cj.Node,cj.Right]),cj=cj.Left);}return[cj,ci];};_1.Rebuild=function(cg,ch){var ci,ck,cl,cm,cn,co,cp,cq,cr,cs;function cj(ct){return ct==null?0:ct.Height;}ci=ch;for(ck=0,cl=q.length(cg)-1;ck<=cl;ck++){ci=(cm=q.get(cg,ck),cm[0]?(cn=cm[1],(co=cm[2],cj(ci)>cj(co)+1?cj(ci.Left)===cj(ci.Right)+1?(cp=ci.Left,_1.Branch(cp.Node,_1.Branch(cn,co,cp.Left),_1.Branch(ci.Node,cp.Right,ci.Right))):_1.Branch(ci.Node,_1.Branch(cn,co,ci.Left),ci.Right):_1.Branch(cn,co,ci))):(cq=cm[1],(cr=cm[2],cj(ci)>cj(cr)+1?cj(ci.Right)===cj(ci.Left)+1?(cs=ci.Right,_1.Branch(cs.Node,_1.Branch(ci.Node,ci.Left,cs.Left),_1.Branch(cq,cs.Right,cr))):_1.Branch(ci.Node,ci.Left,_1.Branch(cq,ci.Right,cr)):_1.Branch(cq,ci,cr))));}return ci;};_1.Branch=function(cg,ch,ci){var cj,ck;return bn.New(cg,ch,ci,1+(cj=ch==null?0:ch.Height,(ck=ci==null?0:ci.Height,w.Compare(cj,ck)===1?cj:ck)),1+(ch==null?0:ch.Count)+(ci==null?0:ci.Count));};_1.Enumerate=function(cg,ch){function ci(cj,ck){var cl;while(true)if(cj==null)return ck.$==1?{$:1,$0:[ck.$0[0],[ck.$0[1],ck.$1]]}:null;else if(cg){cl=cj;cj=cl.Right;ck=new Q({$:1,$0:[cl.Node,cl.Left],$1:ck});}else{cl=cj;cj=cl.Left;ck=new Q({$:1,$0:[cl.Node,cl.Right],$1:ck});}}return v.unfold(function(cj){return ci(cj[0],cj[1]);},[ch,Q.Empty]);};_1.Build=function(cg,ch,ci){var cj,ck,cl;return ci-ch+1<=0?null:(cj=(ch+ci)/2>>0,(ck=_1.Build(cg,ch,cj-1),(cl=_1.Build(cg,cj+1,ci),_1.Branch(q.get(cg,cj),ck,cl))));};_1.OfSeq=function(cg){var ch;ch=q.ofSeq(v.distinct(cg));q.sortInPlace(ch);return _1.Build(ch,0,ch.length-1);};_2.Id=function(){(_2.lastId())[0]++;return"Form"+a.String((_2.lastId())[0]);};_2.lastId=function(){bB.$cctor();return bB.lastId;};_3.ofSeqNonCopying=function(cg){var ch,ci;if(cg instanceof a.Array)return cg;else if(cg instanceof Q)return q.ofList(cg);else if(cg===null)return[];else{ch=[];ci=$.Get(cg);try{while(ci.MoveNext())ch.push(ci.Current());return ch;}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}}};_3.TreeReduce=function(cg,ch,ci){var cj;function ck(cl){return function(cm){var cn,co;return cm<=0?cg:cm===1&&(cl>=0&&cl<cj)?q.get(ci,cl):(co=cm/2>>0,ch((ck(cl))(co),(ck(cl+co))(cm-co)));};}cj=q.length(ci);return(ck(0))(cj);};_3.MapTreeReduce=function(cg,ch,ci,cj){var ck;function cl(cm){return function(cn){var co,cp;return cn<=0?ch:cn===1&&(cm>=0&&cm<ck)?cg(q.get(cj,cm)):(cp=cn/2>>0,ci((cl(cm))(cp),(cl(cm+cp))(cn-cp)));};}ck=q.length(cj);return(cl(0))(ck);};_4=g.AttrProxy=cc.Class({},null,_4);_4.Create=function(cg,ch){return _9.Static(function(ci){ci.setAttribute(cg,ch);});};_4.Concat=function(cg){var ch;ch=_3.ofSeqNonCopying(cg);return _3.TreeReduce(_9.EmptyAttr(),_4.Append,ch);};_4.Append=function(cg,ch){return _9.AppendTree(cg,ch);};_4.Handler=function(cg,ch){return _4.HandlerImpl(cg,ch);};_4.HandlerImpl=function(cg,ch){return _9.Static(function(ci){ci.addEventListener(cg,function(cj){return(ch(ci))(cj);},false);});};_5.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_5.UpdateEmbedNode=function(cg,ch){cg.Current=ch;cg.Dirty=true;};_5.LinkElement=function(cg,ch){_5.InsertDoc(cg,ch,null);};_5.InsertDoc=function(cg,ch,ci){var cj,ck,cl;while(true)if(ch!=null&&ch.$==1)return _5.InsertNode(cg,ch.$0.El,ci);else if(ch!=null&&ch.$==2){cj=ch.$0;cj.Dirty=false;ch=cj.Current;}else if(ch==null)return ci;else if(ch!=null&&ch.$==4)return _5.InsertNode(cg,ch.$0.Text,ci);else if(ch!=null&&ch.$==5)return _5.InsertNode(cg,ch.$0,ci);else if(ch!=null&&ch.$==6)return q.foldBack(function(cm,cn){return(((cc.Curried3(function(co,cp,cq){return cp==null||cp.constructor===_6?_5.InsertDoc(co,cp,cq):_5.InsertNode(co,cp,cq);}))(cg))(cm))(cn);},ch.$0.Els,ci);else{ck=ch.$1;cl=ch.$0;ch=cl;ci=_5.InsertDoc(cg,ck,ci);}};_5.CreateRunState=function(cg,ch){return bG.New(bH.get_Empty(),_5.CreateElemNode(cg,_9.EmptyAttr(),ch));};_5.PerformAnimatedUpdate=function(cg,ch,ci){var cj;return bu.get_UseAnimations()?(cj=null,bz.Delay(function(){var ck,cl,cm;ck=bH.FindAll(ci);cl=_5.ComputeChangeAnim(ch,ck);cm=_5.ComputeEnterAnim(ch,ck);return bz.Bind(bu.Play(bu.Append(cl,_5.ComputeExitAnim(ch,ck))),function(){return bz.Bind(_5.SyncElemNodesNextFrame(cg,ch),function(){return bz.Bind(bu.Play(cm),function(){ch.PreviousNodes=ck;return bz.Return(null);});});});})):_5.SyncElemNodesNextFrame(cg,ch);};_5.PerformSyncUpdate=function(cg,ch,ci){var cj;cj=bH.FindAll(ci);_5.SyncElemNode(cg,ch.Top);ch.PreviousNodes=cj;};_5.InsertNode=function(cg,ch,ci){_.InsertAt(cg,ci,ch);return ch;};_5.CreateElemNode=function(cg,ch,ci){var cj;_5.LinkElement(cg,ci);cj=_9.Insert(cg,ch);return bl.New(cj,ci,null,cg,bj.Int(),cc.GetOptional(cj.OnAfterRender));};_5.SyncElemNodesNextFrame=function(cg,ch){function ci(cj){a.requestAnimationFrame(function(){_5.SyncElemNode(cg,ch.Top);cj();});}return bv.BatchUpdatesEnabled()?bz.FromContinuations(function(cj,ck,cl){return ci.apply(null,[cj,ck,cl]);}):(_5.SyncElemNode(cg,ch.Top),bz.Return(null));};_5.ComputeExitAnim=function(cg,ch){return bu.Concat(q.map(function(ci){return _9.GetExitAnim(ci.Attr);},bH.ToArray(bH.Except(ch,bH.Filter(function(ci){return _9.HasExitAnim(ci.Attr);},cg.PreviousNodes)))));};_5.ComputeEnterAnim=function(cg,ch){return bu.Concat(q.map(function(ci){return _9.GetEnterAnim(ci.Attr);},bH.ToArray(bH.Except(cg.PreviousNodes,bH.Filter(function(ci){return _9.HasEnterAnim(ci.Attr);},ch)))));};_5.ComputeChangeAnim=function(cg,ch){var ci;function cj(ck){return _9.HasChangeAnim(ck.Attr);}ci=function(ck){return bH.Filter(cj,ck);};return bu.Concat(q.map(function(ck){return _9.GetChangeAnim(ck.Attr);},bH.ToArray(bH.Intersect(ci(cg.PreviousNodes),ci(ch)))));};_5.SyncElemNode=function(cg,ch){!cg?_5.SyncElement(ch):void 0;_5.Sync(ch.Children);_5.AfterRender(ch);};_5.InsertBeforeDelim=function(cg,ch){var ci,cj;ci=cg.parentNode;cj=self.document.createTextNode("");ci.insertBefore(cj,cg);_5.LinkPrevElement(cg,ch);return cj;};_5.SyncElement=function(cg){function ch(ci){function cj(ck){var cl,cm,cn,co;while(true){if(ck!=null&&ck.$==0){cm=ck.$1;cn=ck.$0;if(cj(cn))return true;else ck=cm;}else if(ck!=null&&ck.$==2){co=ck.$0;if(co.Dirty)return true;else ck=co.Current;}else return ck!=null&&ck.$==6&&(cl=ck.$0,cl.Dirty||q.exists(ch,cl.Holes));}}return cj(ci.Children);}_9.Sync(cg.El,cg.Attr);if(ch(cg))_5.DoSyncElement(cg);};_5.Sync=function(cg){var ch,ci,cj,ck,cl;while(true){if(cg!=null&&cg.$==1)return _5.SyncElemNode(false,cg.$0);else if(cg!=null&&cg.$==2){cj=cg.$0;cg=cj.Current;}else if(cg==null)return null;else if(cg!=null&&cg.$==5)return null;else if(cg!=null&&cg.$==4){ch=cg.$0;return ch.Dirty?(ch.Text.nodeValue=ch.Value,ch.Dirty=false):null;}else if(cg!=null&&cg.$==6){ci=cg.$0;q.iter(function(cm){return function(cn){_5.SyncElemNode(cm,cn);};}(false),ci.Holes);q.iter(function(cm){_9.Sync(cm[0],cm[1]);},ci.Attrs);return _5.AfterRender(ci);}else{ck=cg.$1;cl=cg.$0;_5.Sync(cl);cg=ck;}}};_5.AfterRender=function(cg){var ch;ch=cc.GetOptional(cg.Render);if(ch!=null&&ch.$==1){ch.$0(cg.El);cc.SetOptional(cg,"Render",null);}};_5.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};_5.UpdateTextNode=function(cg,ch){cg.Value=ch;cg.Dirty=true;};_5.LinkPrevElement=function(cg,ch){_5.InsertDoc(cg.parentNode,ch,cg);};_5.DoSyncElement=function(cg){var ch,ci,cj;function ck(cl,cm){var cn,co,cp,cq;while(true){if(cl!=null&&cl.$==1)return cl.$0.El;else if(cl!=null&&cl.$==2){co=cl.$0;if(co.Dirty){co.Dirty=false;return _5.InsertDoc(ch,co.Current,cm);}else cl=co.Current;}else if(cl==null)return cm;else if(cl!=null&&cl.$==4)return cl.$0.Text;else if(cl!=null&&cl.$==5)return cl.$0;else if(cl!=null&&cl.$==6){cn=cl.$0;cn.Dirty?cn.Dirty=false:void 0;return q.foldBack(function(cr,cs){return cr==null||cr.constructor===_6?ck(cr,cs):cr;},cn.Els,cm);}else{cp=cl.$1;cq=cl.$0;cl=cq;cm=ck(cp,cm);}}}ch=cg.El;b8.Iter((ci=cg.El,function(cl){_.RemoveNode(ci,cl);}),b8.Except(b8.DocChildren(cg),b8.Children(cg.El,cc.GetOptional(cg.Delimiters))));ck(cg.Children,(cj=cc.GetOptional(cg.Delimiters),cj!=null&&cj.$==1?cj.$0[1]:null));};_7=g.CheckedInput=cc.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_7);_8.TryParseInt32=function(cg,ch){return _8.TryParse(cg,-2147483648,2147483647,ch);};_9.Dynamic=function(cg,ch){return new _4({$:1,$0:new bo.New(cg,ch)});};_9.Static=function(cg){return new _4({$:3,$0:cg});};_9.Insert=function(cg,ch){var ci,cj,ck;function cl(cm){var cn,co;while(true)if(!(cm===null)){if(cm!=null&&cm.$==1)return ci.push(cm.$0);else if(cm!=null&&cm.$==2){cn=cm.$1;co=cm.$0;cl(co);cm=cn;}else return cm!=null&&cm.$==3?cm.$0(cg):cm!=null&&cm.$==4?cj.push(cm.$0):null;}else return null;}ci=[];cj=[];cl(ch);ck=ci.slice(0);return bD.New(cg,_9.Flags(ch),ck,cj.length===0?null:{$:1,$0:function(cm){v.iter(function(cn){cn(cm);},cj);}});};_9.Updates=function(cg){return _3.MapTreeReduce(function(ch){return ch.NChanged();},u.Const(),u.Map2Unit,cg.DynNodes);};_9.Empty=function(cg){return bD.New(cg,0,[],null);};_9.EmptyAttr=function(){b0.$cctor();return b0.EmptyAttr;};_9.HasExitAnim=function(cg){var ch;ch=2;return(cg.DynFlags&ch)===ch;};_9.GetExitAnim=function(cg){return _9.GetAnim(cg,function(ch,ci){return ch.NGetExitAnim(ci);});};_9.HasEnterAnim=function(cg){var ch;ch=1;return(cg.DynFlags&ch)===ch;};_9.GetEnterAnim=function(cg){return _9.GetAnim(cg,function(ch,ci){return ch.NGetEnterAnim(ci);});};_9.HasChangeAnim=function(cg){var ch;ch=4;return(cg.DynFlags&ch)===ch;};_9.GetChangeAnim=function(cg){return _9.GetAnim(cg,function(ch,ci){return ch.NGetChangeAnim(ci);});};_9.AppendTree=function(cg,ch){var ci;return cg===null?ch:ch===null?cg:(ci=new _4({$:2,$0:cg,$1:ch}),(_9.SetFlags(ci,_9.Flags(cg)|_9.Flags(ch)),ci));};_9.Flags=function(cg){return cg!==null&&cg.hasOwnProperty("flags")?cg.flags:0;};_9.GetAnim=function(cg,ch){return bu.Concat(q.map(function(ci){return ch(ci,cg.DynElem);},cg.DynNodes));};_9.Sync=function(cg,ch){q.iter(function(ci){ci.NSync(cg);},ch.DynNodes);};_9.SetFlags=function(cg,ch){cg.flags=ch;};_.ParseHTMLIntoFakeRoot=function(cg){var ch,ci,cj,ck,cl;function cm(cn,co){var cp;while(true)if(co===0)return cn;else{cp=co;cn=cn.lastChild;co=cp-1;}}ch=self.document.createElement("div");return!_.rhtml().test(cg)?(ch.appendChild(self.document.createTextNode(cg)),ch):(ci=(cj=_.rtagName().exec(cg),w.Equals(cj,null)?"":q.get(cj,1).toLowerCase()),(ck=(cl=(_.wrapMap())[ci],cl?cl:_.defaultWrap()),(ch.innerHTML=ck[1]+cg.replace(_.rxhtmlTag(),"<$1></$2>")+ck[2],cm(ch,ck[0]))));};_.rhtml=function(){bQ.$cctor();return bQ.rhtml;};_.wrapMap=function(){bQ.$cctor();return bQ.wrapMap;};_.defaultWrap=function(){bQ.$cctor();return bQ.defaultWrap;};_.rxhtmlTag=function(){bQ.$cctor();return bQ.rxhtmlTag;};_.rtagName=function(){bQ.$cctor();return bQ.rtagName;};_.IterSelector=function(cg,ch,ci){var cj,ck,cl;cj=cg.querySelectorAll(ch);for(ck=0,cl=cj.length-1;ck<=cl;ck++)ci(cj[ck]);};_.ChildrenArray=function(cg){var ch,ci,cj;ch=[];for(ci=0,cj=cg.childNodes.length-1;ci<=cj;ci++)ch.push(cg.childNodes[ci]);return ch;};_.InsertAt=function(cg,ch,ci){var cj;if(!(ci.parentNode===cg&&ch===(cj=ci.nextSibling,w.Equals(cj,null)?null:cj)))cg.insertBefore(ci,ch);};_.RemoveNode=function(cg,ch){if(ch.parentNode===cg)cg.removeChild(ch);};$.Get=function(cg){return cg instanceof a.Array?$.ArrayEnumerator(cg):w.Equals(typeof cg,"string")?$.StringEnumerator(cg):cg.GetEnumerator();};$.ArrayEnumerator=function(cg){return new bq.New(0,null,function(ch){var ci;ci=ch.s;return ci<q.length(cg)&&(ch.c=q.get(cg,ci),ch.s=ci+1,true);},void 0);};$.StringEnumerator=function(cg){return new bq.New(0,null,function(ch){var ci;ci=ch.s;return ci<cg.length&&(ch.c=cg[ci],ch.s=ci+1,true);},void 0);};$.Get0=function(cg){return cg instanceof a.Array?$.ArrayEnumerator(cg):w.Equals(typeof cg,"string")?$.StringEnumerator(cg):"GetEnumerator0"in cg?cg.GetEnumerator0():cg.GetEnumerator();};ba=O.HashSet=cc.Class({Add:function(cg){return this.add(cg);},Contains:function(cg){var ch;ch=this.data[this.hash(cg)];return ch==null?false:this.arrContains(cg,ch);},add:function(cg){var ch,ci;ch=this.hash(cg);ci=this.data[ch];return ci==null?(this.data[ch]=[cg],this.count=this.count+1,true):this.arrContains(cg,ci)?false:(ci.push(cg),this.count=this.count+1,true);},arrContains:function(cg,ch){var ci,cj,ck,cl;ci=true;cj=0;cl=ch.length;while(ci&&cj<cl)if(this.equals.apply(null,[ch[cj],cg]))ci=false;else cj=cj+1;return!ci;},ExceptWith:function(cg){var ch;ch=$.Get(cg);try{while(ch.MoveNext())this.Remove(ch.Current());}finally{if(typeof ch=="object"&&"Dispose"in ch)ch.Dispose();}},get_Count:function(){return this.count;},CopyTo:function(cg){var ch,ci,cj,ck;ch=0;ci=bT.concat(this.data);for(cj=0,ck=ci.length-1;cj<=ck;cj++)q.set(cg,cj,ci[cj]);},IntersectWith:function(cg){var ch,ci,cj,ck,cl;ch=new ba.New$4(cg,this.equals,this.hash);ci=bT.concat(this.data);for(cj=0,ck=ci.length-1;cj<=ck;cj++){cl=ci[cj];if(!ch.Contains(cl))this.Remove(cl);}},Remove:function(cg){var ch;ch=this.data[this.hash(cg)];return ch==null?false:this.arrRemove(cg,ch)&&(this.count=this.count-1,true);},arrRemove:function(cg,ch){var ci,cj,ck,cl;ci=true;cj=0;cl=ch.length;while(ci&&cj<cl)if(this.equals.apply(null,[ch[cj],cg])){ch.splice.apply(ch,[cj,1]);ci=false;}else cj=cj+1;return!ci;},GetEnumerator:function(){return $.Get(bT.concat(this.data));},GetEnumerator0:function(){return $.Get(bT.concat(this.data));}},f,ba);ba.New$3=cc.Ctor(function(){ba.New$4.call(this,[],w.Equals,w.Hash);},ba);ba.New$4=cc.Ctor(function(cg,ch,ci){var cj;f.New.call(this);this.equals=ch;this.hash=ci;this.data=[];this.count=0;cj=$.Get(cg);try{while(cj.MoveNext())this.add(cj.Current());}finally{if(typeof cj=="object"&&"Dispose"in cj)cj.Dispose();}},ba);ba.New$2=cc.Ctor(function(cg){ba.New$4.call(this,cg,w.Equals,w.Hash);},ba);q.choose=function(cg,ch){var ci,cj,ck,cl;ci=[];for(cj=0,ck=ch.length-1;cj<=ck;cj++){cl=cg(ch[cj]);if(cl==null);else ci.push(cl.$0);}return ci;};q.ofList=function(cg){var ch,ci;ci=[];ch=cg;while(!(ch.$==0)){ci.push(s.head(ch));ch=s.tail(ch);}return ci;};q.map2=function(cg,ch,ci){var cj,ck,cl;q.checkLength(ch,ci);cj=new a.Array(ci.length);for(ck=0,cl=ci.length-1;ck<=cl;ck++)cj[ck]=cg(ch[ck],ci[ck]);return cj;};q.forall=function(cg,ch){var ci,cj,ck,cl;ci=true;cj=0;cl=q.length(ch);while(ci&&cj<cl)if(cg(ch[cj]))cj=cj+1;else ci=false;return ci;};q.ofSeq=function(cg){var ch,ci;if(cg instanceof a.Array)return cg.slice();else if(cg instanceof Q)return q.ofList(cg);else{ch=[];ci=$.Get(cg);try{while(ci.MoveNext())ch.push(ci.Current());return ch;}finally{if(typeof ci=="object"&&"Dispose"in ci)ci.Dispose();}}};q.init=function(cg,ch){var ci,cj,ck;if(cg<0)e.FailWith("Negative size given.");else null;ci=new a.Array(cg);for(cj=0,ck=cg-1;cj<=ck;cj++)ci[cj]=ch(cj);return ci;};q.exists=function(cg,ch){var ci,cj,ck,cl;ci=false;cj=0;cl=q.length(ch);while(!ci&&cj<cl)if(cg(ch[cj]))ci=true;else cj=cj+1;return ci;};q.tryPick=function(cg,ch){var ci,cj,ck;ci=null;cj=0;while(cj<ch.length&&ci==null){ck=cg(ch[cj]);if(ck!=null&&ck.$==1)ci=ck;cj=cj+1;}return ci;};q.tryFindIndex=function(cg,ch){var ci,cj;ci=null;cj=0;while(cj<ch.length&&ci==null){cg(ch[cj])?ci={$:1,$0:cj}:void 0;cj=cj+1;}return ci;};q.checkLength=function(cg,ch){if(cg.length!==ch.length)e.FailWith("The arrays have different lengths.");};q.filter=function(cg,ch){var ci,cj,ck;ci=[];for(cj=0,ck=ch.length-1;cj<=ck;cj++)if(cg(ch[cj]))ci.push(ch[cj]);return ci;};q.map=function(cg,ch){var ci,cj,ck;ci=new a.Array(ch.length);for(cj=0,ck=ch.length-1;cj<=ck;cj++)ci[cj]=cg(ch[cj]);return ci;};q.iter=function(cg,ch){var ci,cj;for(ci=0,cj=ch.length-1;ci<=cj;ci++)cg(ch[ci]);};q.foldBack=function(cg,ch,ci){var cj,ck,cl,cm,cn;cj=ci;cl=ch.length;for(cm=1,cn=cl;cm<=cn;cm++)cj=cg(ch[cl-cm],cj);return cj;};q.concat=function(cg){return a.Array.prototype.concat.apply([],q.ofSeq(cg));};q.pick=function(cg,ch){var ci;ci=q.tryPick(cg,ch);return ci==null?e.FailWith("KeyNotFoundException"):ci.$0;};q.sortInPlace=function(cg){q.mapInPlace(function(ch){return ch[0];},q.mapiInPlace(function(ch,ci){return[ci,ch];},cg).sort(w.Compare));};q.create=function(cg,ch){var ci,cj,ck;ci=new a.Array(cg);for(cj=0,ck=cg-1;cj<=ck;cj++)ci[cj]=ch;return ci;};bb.$cctor=function(){bb.$cctor=a.ignore;bb.initialized=new W.New$5();};bb=o.TemplateInitializer=cc.Class({},f,bb);bb.GetOrAddHoleFor=function(cg,ch,ci){var cj,ck,cl,cm;bb.$cctor();cj=bb.GetHolesFor(cg);ck=(cl=null,[cj.TryGetValue(ch,{get:function(){return cl;},set:function(cn){cl=cn;}}),cl]);return ck[0]?ck[1]:(cm=ci(),(cj.set_Item(ch,cm),cm));};bb.GetHolesFor=function(cg){var ch,ci,cj;bb.$cctor();ch=(ci=null,[bb.initialized.TryGetValue(cg,{get:function(){return ci;},set:function(ck){ci=ck;}}),ci]);return ch[0]?ch[1]:(cj=new W.New$5(),(bb.initialized.set_Item(cg,cj),cj));};bc.$cctor=function(){bc.$cctor=a.ignore;bc.LoadedTemplates=new W.New$5();bc.LocalTemplatesLoaded=false;bc.GlobalHoles=new W.New$5();bc.TextHoleRE="\\${([^}]+)}";bc.RenderedFullDocTemplate=null;};be.New$1=function(cg,ch){return{Parse:cg,Write:ch};};bf=X.Route=cc.Class({ToLink:function(){return bM.WriteLink(this.Segments,this.QueryArgs);}},null,bf);bf.Segment=function(cg,ch){var ci;ci=bf.get_Empty();return bf.New(cg,ci.QueryArgs,ci.FormData,ch,ci.Body);};bf.FromUrl=function(cg,ch){var ci,cj,ck;ci=(cj=cg.indexOf("?"),cj===-1?[cg,new bx.New([])]:[H.Substring(cg,0,cj),bf.ParseQuery(cg.substring(cj+1))]);ck=bf.get_Empty();return bf.New(s.ofArray(H.SplitChars(ci[0],["/"],ch!=null&&ch.$0?0:1)),ci[1],ck.FormData,ck.Method,ck.Body);};bf.get_Empty=function(){return bf.New(Q.Empty,new bx.New([]),new bx.New([]),null,bL.CreateFromValue(null));};bf.ParseQuery=function(cg){return by.OfArray(q.ofSeq(q.choose(function(ch){var ci,cj;ci=H.SplitChars(ch,["="],0);return!w.Equals(ci,null)&&ci.length===2?(cj=q.get(ci,1),{$:1,$0:[q.get(ci,0),cj]}):((function(ck){return function(cl){return ck("wrong format for query argument: "+I.toSafe(cl));};}(function(ck){cd.log(ck);}))(ch),null);},H.SplitChars(cg,["&"],0))));};bf.Combine=function(cg){var ch,ci,cj,ck,cl,cm,cn;ch=q.ofSeq(cg);ci=q.length(ch);return ci===0?bf.get_Empty():ci===1?q.get(ch,0):(cj=null,ck=null,cl=[],cm=new bx.New([]),cn=new bx.New([]),q.iter(function(co){var cp,cq;cp=co.Method;if(cp!=null&&cp.$==1)cj=cp;cq=co.Body.f();if(cq===null);else ck=cq;cm=by.FoldBack(function(cr,cs,ct){return ct.Add(cr,cs);},cm,co.QueryArgs);cn=by.FoldBack(function(cr,cs,ct){return ct.Add(cr,cs);},cn,co.FormData);s.iter(function(cr){cl.push(cr);},co.Segments);},ch),bf.New(s.ofSeq(cl),cm,cn,cj,bL.CreateFromValue(ck)));};bf.New=function(cg,ch,ci,cj,ck){return new bf({Segments:cg,QueryArgs:ch,FormData:ci,Method:cj,Body:ck});};bg.startsWith=function(cg,ch){var ci;switch(cg.$==1?ch.$==1?w.Equals(cg.$0,ch.$0)?(ci=[ch.$0,ch.$1,cg.$0,cg.$1],1):2:2:0){case 0:return{$:1,$0:ch};case 1:return bg.startsWith(ci[3],ci[1]);case 2:return null;}};bh.ofObj=function(cg){return cg==null?null:{$:1,$0:cg};};bj.Int=function(){bj.set_counter(bj.counter()+1);return bj.counter();};bj.set_counter=function(cg){bN.$cctor();bN.counter=cg;};bj.counter=function(){bN.$cctor();return bN.counter;};bk.Map=function(cg,ch){return ch.$==1?{$:1,$0:ch.$0}:{$:0,$0:cg(ch.$0)};};bl=g.DocElemNode=cc.Class({Equals:function(cg){return this.ElKey===cg.ElKey;},GetHashCode:function(){return this.ElKey;}},null,bl);bl.New=function(cg,ch,ci,cj,ck,cl){var cm;return new bl((cm={Attr:cg,Children:ch,El:cj,ElKey:ck},(cc.SetOptional(cm,"Delimiters",ci),cc.SetOptional(cm,"Render",cl),cm)));};T.Obsolete=function(cg){var ch,ci,cj,ck,cl;ci=cg.s;if(ci==null||(ci!=null&&ci.$==2?(ch=ci.$1,false):ci!=null&&ci.$==3?(ch=ci.$1,false):true))void 0;else{cg.s=null;for(cj=0,ck=q.length(ch)-1;cj<=ck;cj++){cl=q.get(ch,cj);if(typeof cl=="object")(function(cm){T.Obsolete(cm);}(cl));else cl();}}};T.New=function(cg){return{s:cg};};bn.New=function(cg,ch,ci,cj,ck){return{Node:cg,Left:ch,Right:ci,Height:cj,Count:ck};};bo=g.DynamicAttrNode=cc.Class({NChanged:function(){return this.updates;},NGetExitAnim:function(cg){return bu.get_Empty();},NGetEnterAnim:function(cg){return bu.get_Empty();},NGetChangeAnim:function(cg){return bu.get_Empty();},NSync:function(cg){if(this.dirty){(this.push(cg))(this.value);this.dirty=false;}}},f,bo);bo.New=cc.Ctor(function(cg,ch){var ci;ci=this;f.New.call(this);this.push=ch;this.value=void 0;this.dirty=false;this.updates=u.Map(function(cj){ci.value=cj;ci.dirty=true;},cg);},bo);bp.notPresent=function(){return e.FailWith("The given key was not present in the dictionary.");};bq=$.T=cc.Class({MoveNext:function(){return this.n(this);},Current:function(){return this.c;},Dispose:function(){if(this.d)this.d(this);}},f,bq);bq.New=cc.Ctor(function(cg,ch,ci,cj){f.New.call(this);this.s=cg;this.c=ch;this.n=ci;this.d=cj;},bq);br.convertTextNode=function(cg){var ch,ci,cj,ck,cl,cm;ch=null;ci=0;ck=cg.textContent;cl=new a.RegExp(B.TextHoleRE(),"g");while(ch=cl.exec(ck),ch!==null){cg.parentNode.insertBefore(self.document.createTextNode(bs.string(ck,{$:1,$0:ci},{$:1,$0:cl.lastIndex-q.get(ch,0).length-1})),cg);ci=cl.lastIndex;cm=self.document.createElement("span");cm.setAttribute("ws-replace",q.get(ch,1).toLowerCase());cg.parentNode.insertBefore(cm,cg);}cl.lastIndex=0;cg.textContent=bs.string(ck,{$:1,$0:ci},null);};br.failNotLoaded=function(cg){cd.warn("Instantiating non-loaded template",cg);};br.fillTextHole=function(cg,ch,ci){var cj;cj=cg.querySelector("[ws-replace]");return w.Equals(cj,null)?(cd.warn("Filling non-existent text hole",ci),null):(cj.parentNode.replaceChild(self.document.createTextNode(ch),cj),{$:1,$0:cj.getAttribute("ws-replace")});};br.removeHolesExcept=function(cg,ch){function ci(cj){B.foreachNotPreserved(cg,"["+cj+"]",function(ck){if(!ch.Contains(ck.getAttribute(cj)))ck.removeAttribute(cj);});}ci("ws-attr");ci("ws-onafterrender");ci("ws-var");B.foreachNotPreserved(cg,"[ws-hole]",function(cj){if(!ch.Contains(cj.getAttribute("ws-hole"))){cj.removeAttribute("ws-hole");while(cj.hasChildNodes())cj.removeChild(cj.lastChild);}});B.foreachNotPreserved(cg,"[ws-replace]",function(cj){if(!ch.Contains(cj.getAttribute("ws-replace")))cj.parentNode.removeChild(cj);});B.foreachNotPreserved(cg,"[ws-on]",function(cj){cj.setAttribute("ws-on",H.concat(" ",q.filter(function(ck){return ch.Contains(q.get(H.SplitChars(ck,[":"],1),1));},H.SplitChars(cj.getAttribute("ws-on"),[" "],1))));});B.foreachNotPreserved(cg,"[ws-attr-holes]",function(cj){var ck,cl,cm,cn,co;ck=H.SplitChars(cj.getAttribute("ws-attr-holes"),[" "],1);for(cl=0,cm=ck.length-1;cl<=cm;cl++){cn=q.get(ck,cl);cj.setAttribute(cn,(co=new a.RegExp(B.TextHoleRE(),"g"),cj.getAttribute(cn).replace(co,function(cp,cq){return ch.Contains(cq)?cp:"";})));}});};br.fillInstanceAttrs=function(cg,ch){var ci,cj,ck,cl,cm;br.convertAttrs(ch);ci=ch.nodeName.toLowerCase();cj=cg.querySelector("[ws-attr="+ci+"]");if(w.Equals(cj,null))cd.warn("Filling non-existent attr hole",ci);else{cj.removeAttribute("ws-attr");for(ck=0,cl=ch.attributes.length-1;ck<=cl;ck++){cm=ch.attributes.item(ck);if(cm.name==="class"&&cj.hasAttribute("class"))cj.setAttribute("class",cj.getAttribute("class")+" "+cm.nodeValue);else cj.setAttribute(cm.name,cm.nodeValue);}}};br.mapHoles=function(cg,ch){function ci(cj){B.foreachNotPreserved(cg,"["+cj+"]",function(ck){var cl,cm;cl=(cm=null,[ch.TryGetValue(ck.getAttribute(cj).toLowerCase(),{get:function(){return cm;},set:function(cn){cm=cn;}}),cm]);if(cl[0])ck.setAttribute(cj,cl[1]);});}ci("ws-hole");ci("ws-replace");ci("ws-attr");ci("ws-onafterrender");ci("ws-var");B.foreachNotPreserved(cg,"[ws-on]",function(cj){cj.setAttribute("ws-on",H.concat(" ",q.map(function(ck){var cl,cm,cn;cl=H.SplitChars(ck,[":"],1);cm=(cn=null,[ch.TryGetValue(q.get(cl,1),{get:function(){return cn;},set:function(co){cn=co;}}),cn]);return cm[0]?q.get(cl,0)+":"+cm[1]:ck;},H.SplitChars(cj.getAttribute("ws-on"),[" "],1))));});B.foreachNotPreserved(cg,"[ws-attr-holes]",function(cj){var ck,cl,cm;ck=H.SplitChars(cj.getAttribute("ws-attr-holes"),[" "],1);for(cl=0,cm=ck.length-1;cl<=cm;cl++)(function(){var cn;function co(cp,cq){var cr;cr=e.KeyValue(cq);return cp.replace(new a.RegExp("\\${"+cr[0]+"}","ig"),"${"+cr[1]+"}");}cn=q.get(ck,cl);return cj.setAttribute(cn,(((cc.Curried3(v.fold))(co))(cj.getAttribute(cn)))(ch));}());});};br.fill=function(cg,ch,ci){while(true)if(cg.hasChildNodes())ci=ch.insertBefore(cg.lastChild,ci);else return null;};br.convertAttrs=function(cg){var ci,cj,ck,cl,cm,cn,co,cp;function ch(cq){var cr;cr=cg.getAttribute(cq);if(cr===null);else cg.setAttribute(cq,cr.toLowerCase());}ci=cg.attributes;cj=[];ck=[];cl=[];for(cm=0,cn=ci.length-1;cm<=cn;cm++){co=ci.item(cm);if(H.StartsWith(co.nodeName,"ws-on")&&co.nodeName!=="ws-onafterrender"&&co.nodeName!=="ws-on"){cj.push(co.nodeName);ck.push(bs.string(co.nodeName,{$:1,$0:"ws-on".length},null)+":"+co.nodeValue.toLowerCase());}else!H.StartsWith(co.nodeName,"ws-")&&(new a.RegExp(B.TextHoleRE())).test(co.nodeValue)?(co.nodeValue=(cp=new a.RegExp(B.TextHoleRE(),"g"),co.nodeValue.replace(cp,function(cq,cr){return"${"+cr.toLowerCase()+"}";})),cl.push(co.nodeName)):void 0;}if(!(ck.length==0))cg.setAttribute("ws-on",H.concat(" ",ck));if(!(cl.length==0))cg.setAttribute("ws-attr-holes",H.concat(" ",cl));ch("ws-hole");ch("ws-replace");ch("ws-attr");ch("ws-onafterrender");ch("ws-var");q.iter(function(cq){cg.removeAttribute(cq);},cj);};bs.string=function(cg,ch,ci){var cj,ck;return ch==null?ci!=null&&ci.$==1?(cj=ci.$0,cj<0?"":cg.slice(0,cj+1)):"":ci==null?cg.slice(ch.$0):(ck=ci.$0,ck<0?"":cg.slice(ch.$0,ck+1));};bt=O.KeyCollection=cc.Class({GetEnumerator$1:function(){return $.Get(v.map(function(cg){return cg.K;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},f,bt);bt.New=cc.Ctor(function(cg){f.New.call(this);this.d=cg;},bt);bu.get_UseAnimations=function(){return bI.UseAnimations();};bu.Play=function(cg){var ch;ch=null;return bz.Delay(function(){return bz.Bind(bu.Run(a.ignore,bI.Actions(cg)),function(){bI.Finalize(cg);return bz.Return(null);});});};bu.Append=function(cg,ch){return{$:0,$0:bS.Append(cg.$0,ch.$0)};};bu.Run=function(cg,ch){var ci;function cj(ck){function cl(cm){return function(cn){var co;co=cn-cm;ch.Compute(co);cg();return co<=ci?void a.requestAnimationFrame(function(cp){(cl(cm))(cp);}):ck();};}a.requestAnimationFrame(function(cm){(cl(cm))(cm);});}ci=ch.Duration;return ci===0?bz.Zero():bz.FromContinuations(function(ck,cl,cm){return cj.apply(null,[ck,cl,cm]);});};bu.Concat=function(cg){return{$:0,$0:bS.Concat(v.map(bI.List,cg))};};bu.get_Empty=function(){return{$:0,$0:bS.Empty()};};bv.BatchUpdatesEnabled=function(){bJ.$cctor();return bJ.BatchUpdatesEnabled;};bw.StartProcessor=function(cg){var ch;function ci(){var cj;cj=null;return bz.Delay(function(){return bz.Bind(cg,function(){var ck;ck=ch[0];return w.Equals(ck,1)?(ch[0]=0,bz.Zero()):w.Equals(ck,2)?(ch[0]=1,ci()):bz.Zero();});});}ch=[0];return function(){var cj;cj=ch[0];if(w.Equals(cj,0)){ch[0]=1;bz.Start(ci(),null);}else w.Equals(cj,1)?ch[0]=2:void 0;};};bx=O.FSharpMap=cc.Class({Equals:function(cg){return this.get_Count()===cg.get_Count()&&v.forall2(w.Equals,this,cg);},GetEnumerator$1:function(){return $.Get(v.map(function(cg){return{K:cg.Key,V:cg.Value};},_1.Enumerate(false,this.tree)));},get_Count:function(){var cg;cg=this.tree;return cg==null?0:cg.Count;},GetHashCode:function(){return w.Hash(q.ofSeq(this));},get_IsEmpty:function(){return this.tree==null;},Add:function(cg,ch){return new bx.New$1(_1.Add(bK.New(cg,ch),this.tree));},get_Tree:function(){return this.tree;},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();},CompareTo0:function(cg){return v.compareWith(w.Compare,this,cg);}},f,bx);bx.New=cc.Ctor(function(cg){bx.New$1.call(this,bW.fromSeq(cg));},bx);bx.New$1=cc.Ctor(function(cg){f.New.call(this);this.tree=cg;},bx);by.OfArray=function(cg){return new bx.New$1(_1.OfSeq(v.map(function(ch){return bK.New(ch[0],ch[1]);},cg)));};by.FoldBack=function(cg,ch,ci){return v.fold(function(cj,ck){return cg(ck.Key,ck.Value,cj);},ci,_1.Enumerate(true,ch.get_Tree()));};by.ToSeq=function(cg){return v.map(function(ch){return[ch.Key,ch.Value];},_1.Enumerate(false,cg.get_Tree()));};bz.Delay=function(cg){return function(ch){try{(cg(null))(ch);}catch(ci){ch.k({$:1,$0:ci});}};};bz.Bind=function(cg,ch){return bz.checkCancel(function(ci){cg(b2.New(function(cj){var ck;if(cj.$==0){ck=cj.$0;bz.scheduler().Fork(function(){try{(ch(ck))(ci);}catch(cl){ci.k({$:1,$0:cl});}});}else bz.scheduler().Fork(function(){ci.k(cj);});},ci.ct));});};bz.Zero=function(){b3.$cctor();return b3.Zero;};bz.Start=function(cg,ch){var ci,cj;ci=(cj=(bz.defCTS())[0],ch==null?cj:ch.$0);bz.scheduler().Fork(function(){if(!ci.c)cg(b2.New(function(ck){if(ck.$==1)bz.UncaughtAsyncError(ck.$0);},ci));});};bz.Return=function(cg){return function(ch){ch.k({$:0,$0:cg});};};bz.scheduler=function(){b3.$cctor();return b3.scheduler;};bz.checkCancel=function(cg){return function(ch){if(ch.ct.c)bz.cancel(ch);else cg(ch);};};bz.defCTS=function(){b3.$cctor();return b3.defCTS;};bz.UncaughtAsyncError=function(cg){cd.log("WebSharper: Uncaught asynchronous exception",cg);};bz.FromContinuations=function(cg){return function(ch){var ci;function cj(ck){if(ci[0])e.FailWith("A continuation provided by Async.FromContinuations was invoked multiple times");else{ci[0]=true;bz.scheduler().Fork(ck);}}ci=[false];cg(function(ck){cj(function(){ch.k({$:0,$0:ck});});},function(ck){cj(function(){ch.k({$:1,$0:ck});});},function(ck){cj(function(){ch.k({$:2,$0:ck});});});};};bz.cancel=function(cg){cg.k({$:2,$0:new b$.New(cg.ct)});};bA=E.ErrorMessage=cc.Class({},f,bA);bB.$cctor=function(){var cg;bB.$cctor=a.ignore;bB.lastId=[0];bB.Int=(cg=[0],function(){cg[0]++;return cg[0];});};bD.New=function(cg,ch,ci,cj){var ck;ck={DynElem:cg,DynFlags:ch,DynNodes:ci};cc.SetOptional(ck,"OnAfterRender",cj);return ck;};bE=g.Elt=cc.Class({},l,bE);bE.TreeNode=function(cg,ch){var ci,cj;function ck(cl){return cl[1];}ci=bO.Create(ch);return new bE.New$1({$:6,$0:cg},u.Map2Unit((cj=q.map(function(cl){return _9.Updates(ck(cl));},cg.Attrs),_3.TreeReduce(u.Const(),u.Map2Unit,cj)),ci.v),q.get(cg.Els,0),ci);};bE.New=function(cg,ch,ci){var cj,ck;cj=_5.CreateElemNode(cg,ch,ci.docNode);ck=bO.Create(ci.updates);return new bE.New$1({$:1,$0:cj},u.Map2Unit(_9.Updates(cj.Attr),ck.v),cg,ck);};bE.New$1=cc.Ctor(function(cg,ch,ci,cj){l.New.call(this,cg,ch);this.docNode$1=cg;this.updates$1=ch;this.elt=ci;this.rvUpdates=cj;},bE);bG.New=function(cg,ch){return{PreviousNodes:cg,Top:ch};};bH.get_Empty=function(){return{$:0,$0:new ba.New$3()};};bH.FindAll=function(cg){var ch;function ci(cl,cm){var cn,co,cp,cq,cr;while(true)switch(cl){case 0:if(cm!=null&&cm.$==0){co=cm.$1;cp=cm.$0;ci(0,cp);cm=co;}else if(cm!=null&&cm.$==1){cq=cm.$0;cm=cq;cl=1;}else if(cm!=null&&cm.$==2){cr=cm.$0;cm=cr.Current;}else return cm!=null&&cm.$==6?(cn=cm.$0.Holes,(function(cs){return function(ct){q.iter(cs,ct);};}(ck))(cn)):null;break;case 1:ch.push(cm);cm=cm.Children;cl=0;break;}}function cj(cl){return ci(0,cl);}function ck(cl){return ci(1,cl);}ch=[];cj(cg);return{$:0,$0:new ba.New$2(ch)};};bH.Filter=function(cg,ch){return{$:0,$0:b5.Filter(cg,ch.$0)};};bH.Except=function(cg,ch){return{$:0,$0:b5.Except(cg.$0,ch.$0)};};bH.ToArray=function(cg){return b5.ToArray(cg.$0);};bH.Intersect=function(cg,ch){return{$:0,$0:b5.Intersect(cg.$0,ch.$0)};};bI.UseAnimations=function(){bR.$cctor();return bR.UseAnimations;};bI.Actions=function(cg){return bI.ConcatActions(q.choose(function(ch){return ch.$==1?{$:1,$0:ch.$0}:null;},bS.ToArray(cg.$0)));};bI.Finalize=function(cg){q.iter(function(ch){if(ch.$==0)ch.$0();},bS.ToArray(cg.$0));};bI.ConcatActions=function(cg){var ch,ci,cj,ck;ch=_3.ofSeqNonCopying(cg);ci=q.length(ch);return ci===0?bI.Const():ci===1?q.get(ch,0):(cj=v.max(v.map(function(cl){return cl.Duration;},ch)),(ck=q.map(function(cl){return bI.Prolong(cj,cl);},ch),bI.Def(cj,function(cl){q.iter(function(cm){cm.Compute(cl);},ck);})));};bI.List=function(cg){return cg.$0;};bI.Const=function(cg){return bI.Def(0,function(){return cg;});};bI.Def=function(cg,ch){return{Compute:ch,Duration:cg};};bI.Prolong=function(cg,ch){var ci,cj,ck;ci=ch.Compute;cj=ch.Duration;ck=bL.Create(function(){return ch.Compute(ch.Duration);});return{Compute:function(cl){return cl>=cj?ck.f():ci(cl);},Duration:cg};};bJ.$cctor=function(){bJ.$cctor=a.ignore;bJ.BatchUpdatesEnabled=true;};bK=O.Pair=cc.Class({Equals:function(cg){return w.Equals(this.Key,cg.Key);},GetHashCode:function(){return w.Hash(this.Key);},CompareTo0:function(cg){return w.Compare(this.Key,cg.Key);}},null,bK);bK.New=function(cg,ch){return new bK({Key:cg,Value:ch});};bL.CreateFromValue=function(cg){return bV.New(true,cg,bL.cachedLazy);};bL.cachedLazy=function(){return this.v;};bL.Create=function(cg){return bV.New(false,cg,bL.forceLazy);};bL.forceLazy=function(){var cg;cg=this.v();this.c=true;this.v=cg;this.f=bL.cachedLazy;return cg;};bM.WriteLink=function(cg,ch){var ci;ci=ch.get_IsEmpty()?"":"?"+bM.WriteQuery(ch);return"/"+bM.Concat(cg)+ci;};bM.Concat=function(cg){var ch,ci;ch=[];ci=true;s.iter(function(cj){if(!H.IsNullOrEmpty(cj)){ci?ci=false:ch.push("/");ch.push(cj);}},cg);return H.Join("",q.ofSeq(ch));};bM.WriteQuery=function(cg){function ch(ci,cj){return ci+"="+cj;}return H.concat("&",v.map(function(ci){return ch(ci[0],ci[1]);},by.ToSeq(cg)));};bN.$cctor=function(){bN.$cctor=a.ignore;bN.counter=0;};bO=g.Updates=cc.Class({},null,bO);bO.Create=function(cg){var ch;ch=null;ch=bO.New(cg,null,function(){var ci;ci=ch.s;return ci===null?(ci=T.Copy(ch.c()),ch.s=ci,T.WhenObsoleteRun(ci,function(){ch.s=null;}),ci):ci;});return ch;};bO.New=function(cg,ch,ci){return new bO({c:cg,s:ch,v:ci});};bP=O.ValueCollection=cc.Class({GetEnumerator$1:function(){return $.Get(v.map(function(cg){return cg.V;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},f,bP);bP.New=cc.Ctor(function(cg){f.New.call(this);this.d=cg;},bP);bQ.$cctor=function(){var cg;bQ.$cctor=a.ignore;bQ.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");bQ.rtagName=new a.RegExp("<([\\w:]+)");bQ.rhtml=new a.RegExp("<|&#?\\w+;");bQ.wrapMap=(cg=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:cg,tbody:cg,tfoot:cg,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});bQ.defaultWrap=[0,"",""];};bR.$cctor=function(){bR.$cctor=a.ignore;bR.CubicInOut=b1.Custom(function(cg){var ch;ch=cg*cg;return 3*ch-2*(ch*cg);});bR.UseAnimations=true;};bS.Append=function(cg,ch){return cg.$==0?ch:ch.$==0?cg:{$:2,$0:cg,$1:ch};};bS.ToArray=function(cg){var ch;function ci(cj){var ck,cl;while(true)if(cj.$==1)return ch.push(cj.$0);else if(cj.$==2){ck=cj.$1;cl=cj.$0;ci(cl);cj=ck;}else return cj.$==3?q.iter(function(cm){ch.push(cm);},cj.$0):null;}ch=[];ci(cg);return ch.slice(0);};bS.Concat=function(cg){var ch;ch=_3.ofSeqNonCopying(cg);return _3.TreeReduce(bS.Empty(),bS.Append,ch);};bS.Empty=function(){ca.$cctor();return ca.Empty;};bT.concat=function(cg){var ch,ci;ch=[];for(var cj in cg)ch.push.apply(ch,cg[cj]);return ch;};bV.New=function(cg,ch,ci){return{c:cg,v:ch,f:ci};};bW.fromSeq=function(cg){var ch;ch=q.ofSeq(v.map(function(ci){return bK.New(ci[0],ci[1]);},v.distinctBy(function(ci){return ci[0];},v.rev(cg))));q.sortInPlace(ch);return _1.Build(ch,0,ch.length-1);};bX=bz.Scheduler=cc.Class({Fork:function(cg){var ch;ch=this;this.robin.push(cg);if(this.idle){this.idle=false;a.setTimeout(function(){ch.tick();},0);}},tick:function(){var cg,ch,ci;ch=this;ci=cf.now();cg=true;while(cg)if(this.robin.length===0){this.idle=true;cg=false;}else{(this.robin.shift())();cf.now()-ci>40?(a.setTimeout(function(){ch.tick();},0),cg=false):void 0;}}},f,bX);bX.New=cc.Ctor(function(){f.New.call(this);this.idle=true;this.robin=[];},bX);bY.Clear=function(cg){cg.splice(0,q.length(cg));};bZ.StringApply=function(){b0.$cctor();return b0.StringApply;};bZ.BoolCheckedApply=function(){b0.$cctor();return b0.BoolCheckedApply;};bZ.IntApplyChecked=function(){b0.$cctor();return b0.IntApplyChecked;};bZ.IntApplyUnchecked=function(){b0.$cctor();return b0.IntApplyUnchecked;};bZ.FloatApplyChecked=function(){b0.$cctor();return b0.FloatApplyChecked;};bZ.FloatApplyUnchecked=function(){b0.$cctor();return b0.FloatApplyUnchecked;};bZ.ApplyValue=function(cg,ch,ci){var cj;function ck(cl,cm){return cm==null?null:cl(cm.$0);}cj=null;return[function(cl){function cm(){ci.UpdateMaybe(function(cn){var co;cj=cg(cl);return cj!=null&&cj.$==1&&(!w.Equals(cj.$0,cn)&&(co=[cj,cj.$0],true))?co[0]:null;});}cl.addEventListener("change",cm);cl.addEventListener("input",cm);cl.addEventListener("keypress",cm);},function(cl){var cm;cm=ch(cl);return function(cn){return ck(cm,cn);};},u.Map(function(cl){var cm;return cj!=null&&cj.$==1&&(w.Equals(cj.$0,cl)&&(cm=cj.$0,true))?null:{$:1,$0:cl};},ci.get_View())];};bZ.StringSet=function(){b0.$cctor();return b0.StringSet;};bZ.StringGet=function(){b0.$cctor();return b0.StringGet;};bZ.IntSetUnchecked=function(){b0.$cctor();return b0.IntSetUnchecked;};bZ.IntGetUnchecked=function(){b0.$cctor();return b0.IntGetUnchecked;};bZ.IntSetChecked=function(){b0.$cctor();return b0.IntSetChecked;};bZ.IntGetChecked=function(){b0.$cctor();return b0.IntGetChecked;};bZ.FloatSetUnchecked=function(){b0.$cctor();return b0.FloatSetUnchecked;};bZ.FloatGetUnchecked=function(){b0.$cctor();return b0.FloatGetUnchecked;};bZ.FloatSetChecked=function(){b0.$cctor();return b0.FloatSetChecked;};bZ.FloatGetChecked=function(){b0.$cctor();return b0.FloatGetChecked;};b0.$cctor=function(){var cg,ch,ci,cj,ck,cl,cm,cn,co,cp;b0.$cctor=a.ignore;b0.EmptyAttr=null;b0.BoolCheckedApply=function(cq){function cr(cs,ct){return ct!=null&&ct.$==1?void(cs.checked=ct.$0):null;}return[function(cs){cs.addEventListener("change",function(){return!w.Equals(cq.Get(),cs.checked)?cq.Set(cs.checked):null;});},function(cs){return function(ct){return cr(cs,ct);};},u.Map(function(cs){return{$:1,$0:cs};},cq.get_View())];};b0.StringSet=function(cq){return function(cr){cq.value=cr;};};b0.StringGet=function(cq){return{$:1,$0:cq.value};};b0.StringApply=(cg=bZ.StringGet(),(ch=bZ.StringSet(),function(cq){return bZ.ApplyValue(cg,ch,cq);}));b0.IntSetUnchecked=function(cq){return function(cr){cq.value=a.String(cr);};};b0.IntGetUnchecked=function(cq){var cr,cs;cr=cq.value;return b6.isBlank(cr)?{$:1,$0:0}:(cs=+cr,cs!==cs>>0?null:{$:1,$0:cs});};b0.IntApplyUnchecked=(ci=bZ.IntGetUnchecked(),(cj=bZ.IntSetUnchecked(),function(cq){return bZ.ApplyValue(ci,cj,cq);}));b0.IntSetChecked=function(cq){return function(cr){var cs;cs=cr.get_Input();return cq.value!==cs?void(cq.value=cs):null;};};b0.IntGetChecked=function(cq){var cr,cs,ct;cr=cq.value;return{$:1,$0:b6.isBlank(cr)?(cq.checkValidity?cq.checkValidity():true)?new _7({$:2,$0:cr}):new _7({$:1,$0:cr}):(cs=(ct=0,[_8.TryParseInt32(cr,{get:function(){return ct;},set:function(cu){ct=cu;}}),ct]),cs[0]?new _7({$:0,$0:cs[1],$1:cr}):new _7({$:1,$0:cr}))};};b0.IntApplyChecked=(ck=bZ.IntGetChecked(),(cl=bZ.IntSetChecked(),function(cq){return bZ.ApplyValue(ck,cl,cq);}));b0.FloatSetUnchecked=function(cq){return function(cr){cq.value=a.String(cr);};};b0.FloatGetUnchecked=function(cq){var cr,cs;cr=cq.value;return b6.isBlank(cr)?{$:1,$0:0}:(cs=+cr,a.isNaN(cs)?null:{$:1,$0:cs});};b0.FloatApplyUnchecked=(cm=bZ.FloatGetUnchecked(),(cn=bZ.FloatSetUnchecked(),function(cq){return bZ.ApplyValue(cm,cn,cq);}));b0.FloatSetChecked=function(cq){return function(cr){var cs;cs=cr.get_Input();return cq.value!==cs?void(cq.value=cs):null;};};b0.FloatGetChecked=function(cq){var cr,cs;cr=cq.value;return{$:1,$0:b6.isBlank(cr)?(cq.checkValidity?cq.checkValidity():true)?new _7({$:2,$0:cr}):new _7({$:1,$0:cr}):(cs=+cr,a.isNaN(cs)?new _7({$:1,$0:cr}):new _7({$:0,$0:cs,$1:cr}))};};b0.FloatApplyChecked=(co=bZ.FloatGetChecked(),(cp=bZ.FloatSetChecked(),function(cq){return bZ.ApplyValue(co,cp,cq);}));};b1=g.Easing=cc.Class({},f,b1);b1.Custom=function(cg){return new b1.New(cg);};b1.New=cc.Ctor(function(cg){f.New.call(this);this.transformTime=cg;},b1);b2.New=function(cg,ch){return{k:cg,ct:ch};};b3.$cctor=function(){b3.$cctor=a.ignore;b3.noneCT=b4.New(false,[]);b3.scheduler=new bX.New();b3.defCTS=[new b7.New()];b3.Zero=bz.Return();b3.GetCT=function(cg){cg.k({$:0,$0:cg.ct});};};b4.New=function(cg,ch){return{c:cg,r:ch};};b5.Filter=function(cg,ch){return new ba.New$2(q.filter(cg,b5.ToArray(ch)));};b5.Except=function(cg,ch){var ci;ci=new ba.New$2(b5.ToArray(ch));ci.ExceptWith(b5.ToArray(cg));return ci;};b5.ToArray=function(cg){var ch;ch=q.create(cg.get_Count(),void 0);cg.CopyTo(ch);return ch;};b5.Intersect=function(cg,ch){var ci;ci=new ba.New$2(b5.ToArray(cg));ci.IntersectWith(b5.ToArray(ch));return ci;};b6.isBlank=function(cg){return H.forall(b9.IsWhiteSpace,cg);};b7=d.CancellationTokenSource=cc.Class({},f,b7);b7.New=cc.Ctor(function(){f.New.call(this);this.c=false;this.pending=null;this.r=[];this.init=1;},b7);b8.Children=function(cg,ch){var ci,cj,ck;if(ch!=null&&ch.$==1){ck=[];ci=ch.$0[0].nextSibling;while(ci!==ch.$0[1]){ck.push(ci);ci=ci.nextSibling;}return{$:0,$0:ck};}else return{$:0,$0:q.init(cg.childNodes.length,(cj=cg.childNodes,function(cl){return cj[cl];}))};};b8.Except=function(cg,ch){var ci;ci=cg.$0;return{$:0,$0:q.filter(function(cj){return q.forall(function(ck){return!(cj===ck);},ci);},ch.$0)};};b8.Iter=function(cg,ch){q.iter(cg,ch.$0);};b8.DocChildren=function(cg){var ch;function ci(cj){var ck,cl,cm,cn;while(true){if(cj!=null&&cj.$==2){cl=cj.$0;cj=cl.Current;}else if(cj!=null&&cj.$==1)return ch.push(cj.$0.El);else if(cj==null)return null;else if(cj!=null&&cj.$==5)return ch.push(cj.$0);else if(cj!=null&&cj.$==4)return ch.push(cj.$0.Text);else if(cj!=null&&cj.$==6){ck=cj.$0.Els;return(function(co){return function(cp){q.iter(co,cp);};}(function(co){if(co==null||co.constructor===_6)ci(co);else ch.push(co);}))(ck);}else{cm=cj.$1;cn=cj.$0;ci(cn);cj=cm;}}}ch=[];ci(cg.Children);return{$:0,$0:_3.ofSeqNonCopying(ch)};};b9.IsWhiteSpace=function(cg){return cg.match(new a.RegExp("\\s"))!==null;};_8.TryParse=function(cg,ch,ci,cj){var ck,cl;ck=+cg;cl=ck===ck-ck%1&&ck>=ch&&ck<=ci;if(cl)cj.set(ck);return cl;};b$=d.OperationCanceledException=cc.Class({},b_,b$);b$.New=cc.Ctor(function(cg){b$.New$1.call(this,"The operation was canceled.",null,cg);},b$);b$.New$1=cc.Ctor(function(cg,ch,ci){this.message=cg;this.inner=ch;_6.setPrototypeOf(this,b$.prototype);this.ct=ci;},b$);ca.$cctor=function(){ca.$cctor=a.ignore;ca.Empty={$:0};};cc.OnLoad(function(){c.Main();});}(self));


if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '/Content/';
  IntelliFactory.Runtime.Start();
}
